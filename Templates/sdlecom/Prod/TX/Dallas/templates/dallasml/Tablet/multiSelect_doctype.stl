

<#--
displayMultiSelectFilterColumnCount:
  display an checkbox entry in a to-be-filtered column. Each entry has a column value and a count value.
-->
<#macro displayMultiSelectFilterColumnCount(name, column count)>
 <#assign t1 = pageStyleUtil.addOrSetQuery(searchResult.queryString, "start", null)>
 <#if (!count.isFiltered)>
  <#assign t2 = pageStyleUtil.appendQuery(t1, "q", name + ":\"" + count.columnValue?if_exists + "\"")>
    <input type="checkbox" name="${name}" value="${count.columnValue}" /><a href="?${t2}&searchable=${searchable}">${count.columnValue}</a>(<span>${count.value}</span>)
    <br/>
 </#if>
</#macro>

<#--
The real rendering is here. Actually, still render it almost similar to a normal narrowBy search
-->

<#assign filterColumn = searchResult.filterResult.getFilterColumn("DocType")>
<#if (filterColumn?has_content && filterColumn.counts.size()>0) >
<#if (filterColumn.counts.size() >= 1) && !(filterColumn.counts[0].isFiltered) >
 <#assign c = filterColumn.setRendered().column>
 <div class="filter_list">
  <p class="filter_head"><span class="active"></span><@displayParentFilteredColumn c />${c.displayName}</p> 
  <div class="filter_body" id="filter_${c.name}" style="display: none; ">
    <#foreach cCount in filterColumn.getTopCounts(20)>
      <@displayMultiSelectFilterColumnCount c.name, c, cCount/>
    </#foreach>
    <form style="display:none">
      <input type="submit" class="button" value="Filter"/>
    </form>
  </div>
 </div>
<br/>
</#if>
</#if>

<style>
.multi_select form input.button,button.button {
  font-family:verdana,arial,geneva,sans-serif;
  font-weight:bold;
  font-size:12px;
  margin:6px 0px 0px 0px;
  padding:1px 3px 1px 3px;
  color:white;
  text-decoration:none;
  background:#2191C0 url(resources/styles/images/ui-bg_gloss-wave_50_6eac2c_500x100.png) repeat-x scroll 50% 50%;border:1px solid #4297D7;color:#EAF5F7; 
  cursor: pointer;
}
.multi_select form input.button:active {
  background:#355A82;
  border-top:solid 2px #2A537B;
  border-left:solid 2px #2A537B;
}
.multi_select form input.button:hover,button.button:hover {
  background:#2191C0 url(resources/styles/images/ui-bg_gloss-wave_50_6eac2c_500x100.png) repeat-x scroll 50% 50%;border:1px solid #4297D7;color:#EAF5F7;
}
</style>
<script type="text/javascript" src="<@com.currentUrlPrefix/>/resource/jquery.query.js"></script>
<script type="text/javascript">
$().ready(function(){
  $('#filter_DocType input').click(function(){
    $('#filter_DocType form').show('slow');
  });
  $('#filter_DocType form input').click(function(event){
    event.preventDefault();
    var selections = $.map($('#filter_DocType input:checked'),function(a){return a.value.replace(",","\\,")}).join(",");
    $.query.REMOVE('start');
    window.location=$.query.set('q', $.query.get('q').toString() + " DocType:\""+selections+"\"").toString();
  });
});
</script>

