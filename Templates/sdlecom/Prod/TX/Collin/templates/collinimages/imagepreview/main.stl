<#-- ADD GOOGLE ANALYTICS -->
<#include "/templates/googleAnalytics-Collin.stl">

<#if request.getServletContext().getInitParameter("isSecurityEnabled") == "false" || (pageStyleUtil.isUserInRoleGroup('ALL_ROLE', request))>
<#if searchResult.docs?has_content>
	<#foreach doc in searchResult.docs>
		<#assign imagelocation = "\\\\" + doc.get("Server") + "\\" +  doc.get("Path") + "\\" + doc.get("Year") + "\\" + doc.get("Month") + "\\" + doc.get("Day") + "\\" + doc.get("ImageName")>
                <#assign baos = new("java.io.ByteArrayOutputStream")>
		<#assign converter = new("com.fdt.common.util.TIFFToPDFConverter")>
		<#if pageStyleUtil.isUserInRoleGroup('UNOFFICIAL_ROLE', request)>
			<#if (converter.convert(imagelocation + ".burned", "UNOFFICIAL",80,80,80,100,0,true,baos,false,0.5,true) == true)> 
				${response.reset()}
				${response.resetBuffer()}
				${response.setContentType("application/pdf")}
				${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
				${response.setHeader("Expires", " 0")}
				${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
				${response.setHeader("Pragma" , "public")}      
				${baos.writeTo(response.getOutputStream())}
				${response.getOutputStream().flush()}
			<#elseif (converter.convert(imagelocation, "UNOFFICIAL",80,80,80,100,0,true,baos,false,0.5,true) == true)>        
                                ${response.reset()}
				${response.resetBuffer()}
				${response.setContentType("application/pdf")}
				${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
				${response.setHeader("Expires", " 0")}
				${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
				${response.setHeader("Pragma" , "public")}      
				${baos.writeTo(response.getOutputStream())}
				${response.getOutputStream().flush()}
			<#else>
				<br />
				<br />
				<center><b>Image is Unavailable. Please contact Granicus Support at supportRMS@granicus.com with subject line as the <i>Site Name</i> you are trying to access and <i>Instrument</i> number you are trying to view.</b></center>
				<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
			</#if>
		<#elseif pageStyleUtil.isUserInRoleGroup('PER_PAGE_ROLE', request)>
			<#if (converter.convert(imagelocation + ".burned", "UNOFFICIAL",80,80,80,100,0,true,baos,false,0.5,true) == true)> 
				${response.reset()}
				${response.resetBuffer()}
				${response.setContentType("application/pdf")}
				${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
				${response.setHeader("Expires", " 0")}
				${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
				${response.setHeader("Pragma" , "public")}      
				${baos.writeTo(response.getOutputStream())}
				${response.getOutputStream().flush()}
			<#elseif (converter.convert(imagelocation, "UNOFFICIAL",80,80,80,100,0,true,baos,false,0.5,true) == true)>        
				${response.reset()}
				${response.resetBuffer()}
				${response.setContentType("application/pdf")}
				${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
				${response.setHeader("Expires", " 0")}
				${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
				${response.setHeader("Pragma" , "public")}      
				${baos.writeTo(response.getOutputStream())}
				${response.getOutputStream().flush()}
			<#else>
				<br />
				<br />
				<center><b>Image is Unavailable. Please contact Granicus Support at supportRMS@granicus.com with subject line as the <i>Site Name</i> you are trying to access and <i>Instrument</i> number you are trying to view.</b></center>
				<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
			</#if>
		</#if>
	</#foreach>
<#else>
	<br />
	<br />
        <center><b>Image is Unavailable. Please contact Granicus Support at supportRMS@granicus.com with subject line as the <i>Site Name</i> you are trying to access and <i>Instrument</i> number you are trying to view.</b></center>
	<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
</#if>
<#else>
	<br />
	<br />
	<center><b>You are not authorized to access this information.</b></center>
</#if>