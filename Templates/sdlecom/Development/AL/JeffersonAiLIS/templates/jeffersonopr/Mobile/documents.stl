<#assign searchCriteria = "Search Criteria " + Request.searchForm.searchQuery >
<#if filtersApplied?has_content>
    <#assign searchCriteria = searchCriteria + " Filters Applied: " +filtersApplied>
</#if>

<#if (searchResult.docs?has_content && searchResult.docs.size() > 0) >
<#assign ResultId =0>
 <#foreach doc in searchResult.docs>
     <p class="result">
     <br/><b>Instrument</b>:${searchResult.highlight(doc, "Instrument")}
          <br/><b>Recorded Date</b>:
                     <#if doc.get("RecDateDisplay")?has_content>
                     ${pageStyleUtil.format(doc.get("RecDateDisplay"), "yyyy-MM-dd HH:mm:ss", "MM/dd/yyyy HH:mm:ss a")}         
        </#if>
      <#if isPhoneticSearch == "1">
       <br/><b>${searchResult.datasetConfiguration.getColumn("PhoneticName").displayName}</b>: ${searchResult.highlight(doc, "PhoneticName")}      
       <#else>
            <br/><b>${searchResult.datasetConfiguration.getColumn("Name").displayName}</b>: ${searchResult.highlight(doc, "Name")}
       </#if>  
      <br /><b>${searchResult.datasetConfiguration.getColumn("PartyRole").displayName}</b>: ${searchResult.highlight(doc, "PartyRole")}
      <br /><b>${searchResult.datasetConfiguration.getColumn("DocTypeDesc").displayName}</b>: ${searchResult.highlight(doc, "DocTypeDesc")}
      <br /><b>${searchResult.datasetConfiguration.getColumn("Book").displayName}</b>: ${searchResult.highlight(doc, "Book")}
      <br /><b>${searchResult.datasetConfiguration.getColumn("Page").displayName}</b>: ${searchResult.highlight(doc, "Page")}
      <br /><b>${searchResult.datasetConfiguration.getColumn("OtherName").displayName}</b>: ${searchResult.highlight(doc, "OtherName")}
      <br /><b>${searchResult.datasetConfiguration.getColumn("LegalDescription").displayName}</b>: ${searchResult.highlight(doc, "LegalDescription")}
      <br /><b>${searchResult.datasetConfiguration.getColumn("FirstReference").displayName}</b>:${searchResult.highlight(doc, "FirstReference")}
      		<#--<a href="search.do?indexName=docs_docchain&templateName=chain&q=${doc.get("Instrument")}">${searchResult.highlight(doc, "FirstReference")}</a>-->

      <#if request.isUserInRole('ROAM_ADMIN') || request.isUserInRole('JEFFERSON_ADMIN')>
       <br /><b>Add to Briefcase</b>: 
         <a href="javascript:;" onclick="addToCart('indexName?=?${indexName}?=?${dc.displayName}', 'Instrument?=?${doc.get("Instrument")}?con?Instrument?=?${doc.get("Instrument")?replace("'", "\\'")?replace("\"", "\\\"")}?con?${searchResult.datasetConfiguration.getColumn("DocType").displayName}?=?${doc.get("DocType")?replace("'", "\\'")?replace("\"", "\\\"")?trim}', 'Instrument%3A${doc.get("Instrument")}', '25');" >Add to Briefcase</a>        
       <br /><b>View Image</b>: 
         <a class="nocolor" href="search.do?indexName=publicimages&lq=${pageStyleUtil.encodeURL("Instrument:" + doc.get("Instrument"))}" target="_blank">Click to View</a>
      <#elseif request.isUserInRole('JEFFERSON_PERPAGE_ACCESS')  || request.isUserInRole('JEFFERSON_PROBATE_ACCESS')>
        <br /><b>View Image</b>: 
         <a class="nocolor" href="search.do?indexName=publicimages&templateName=imagepreview&lq=${pageStyleUtil.encodeURL("Instrument:" + doc.get("Instrument"))}" target="_blank">Click to Preview Image</a>
        <br /><b>Add to Cart</b>:
         <input class="cartLink" type="button" title="${doc.get("Instrument")}" value="Add to Cart"/>
      </#if>
      <br /><b>View Details:<a href="${request.getContextPath()}/search.do?indexName=jeffersondetails&templateName=default_mobile&lq=${pageStyleUtil.encodeURL("Instrument:\"" + doc.get("Instrument") + "\"")}">Click to View Details</a>
</#foreach>
<#else>
 <#include "noResults.stl"> 
</#if>




<script type="text/javascript">
$(document).ready(function() {
    oTable = $('#doc').dataTable({
        "bJQueryUI": true,
        "bPaginate": false,
        "bLengthChange": false,
        "bFilter": false,
        "bSort": true,
        "bInfo": false,
        "bAutoWidth": false,
        "aaSorting": []
    });

     $(".cartLink").click(function() {
        var dataString = 'indexName=publicimages&lq=Instrument:' + $(this).attr("title");
        $.ajax({
          type: "POST",
          url: "${request.getContextPath()}/search.do",
          data: dataString,      
          success: function(data) {
            $.each(data, function(i,item){                  
                 if (item.code == "EXISTS") {
                    var txt = item.description + "You can view your purchase using the below link, <br/> <a target='_blank' href='viewPayAsUGoPaymentDetails.admin?webTxId=" + item.moduleName + "'>View Purchase</a>";     
                    $.prompt(txt);
                 } else if (item.code == "SUCCESS") {
                    if (item.count == 0) {
                        $("span#shoppingCartItems").text('  Shopping cart is Empty');
                        $.prompt(item.description);
                    } else {
                        $("span#shoppingCartItems").text('  ' + item.count + ' Item(s) in the Shopping Cart');
                        $.prompt(item.description);
                    }
                 } else {
                    $.prompt(item.description); 
                 }
              });     
          }
        });
          return false;
    });
} );
</script>