(function(a){a.fn.ticker=function(b){settings=jQuery.extend({pxpersec:30},b);if(this.length!=1){throw"Ticker can only be attached to a single element"}if(this.children("ul").length!=1){throw"Ticker container must contain a UL, eg <div id='ticker'><ul></ul></div>"}return new a.ticker(this,settings)};a.ticker=function(f,h){var b=[];var g=[];var i;var n=0;var e=this;var l=0;var d=0;var m=f;var c=f.children().first();c.css({margin:0,padding:0,listStyleType:"none",whiteSpace:"nowrap","float":"left",position:"absolute",right:0,oTransition:"right 0s linear 0",webkitTransition:"right 0s linear 0",mozTransition:"right 0s linear 0",transition:"right 0s linear 0"});m.css({overflow:"hidden"});if(!m.css("float")||m.css("float")=="none"){m.css("display","block")}if(c.children("li").length){o()}function o(){i=1;if(!c.children("li").length){throw"Cannot initialise ticker: Nothing in it"}c.children("li").each(function(){if(!a(this).attr("id")){a(this).attr("id","msg"+Math.ceil(Math.random()*99999999))}a(this).addClass("seg1").attr("seg",1)});d=1;n=1;c.bind("webkitTransitionEnd",j);c.bind("oTransitionEnd",j);c.bind("mozTransitionEnd",j);c.bind("transitionEnd",j);j()}function j(t){if(n){if(i>1){for(var q=(i-1);q>=1;q--){c.find(".seg"+(q+1)).remove();c.find(".seg"+q).clone().removeClass("seg"+q).removeAttr("id").addClass("seg"+(q+1)).attr("seg",(q+1)).insertBefore(c.find(".seg"+q).first())}}if(c.find(".empty").length){c.unbind().css({webkitTransitionDuration:"0s"}).children().remove();d=0;return}var s=k();if(s.total<(m.width()+s.seg1)){var r=c.children(".seg"+i);var r=r.clone().removeAttr("id").removeClass("seg"+i);if(!s["seg"+i]){throw"Ticker is zero-width"}var p=Math.ceil((m.width()+s.seg1-s.total)/s["seg"+i]);for(var q=1;q<=p;q++){i++;c.prepend(r.clone().addClass("seg"+i).attr("seg",i));s["seg"+i]=s["seg"+(i-1)];s.total+=s["seg"+i]}}if(s.total>(m.width()+(s.seg1*2))){c.find(".seg"+i).remove();i--;s.total-=s["seg"+(i+1)];delete s["seg"+(i+1)]}l=s.seg1;c.width(s.total);n--}if(g.length||b.length){if(g.length){for(var q=g.length-1;q>=0;q--){a(g[q]).remove()}g=[];if(!c.find(".seg1").length){a('<li class="seg1 empty"></li>').width(m.width()).appendTo(c)}}if(b.length){for(var q=b.length-1;q>=0;q--){a(b[q]).addClass("seg1").attr("seg",1).appendTo(c)}b=[];c.find(".seg1").filter(".empty").remove()}var s=k();l=s.seg1;c.width(s.total);n=i}c.css({webkitTransitionDuration:"0s",mozTransitionDuration:"0s",oTransitionDuration:"0s",transitionDuration:"0s"});c.css({right:"-"+l+"px"});dur=Math.floor(l/h.pxpersec);setTimeout(function(){c.css({webkitTransitionDuration:dur+"s",mozTransitionDuration:dur+"s",oTransitionDuration:dur+"s",transitionDuration:"0s"});c.css({right:0+"px"})},0)}function k(){var p={total:0};c.children().each(function(){if(typeof p["seg"+a(this).attr("seg")]=="undefined"){p["seg"+a(this).attr("seg")]=0}p["seg"+a(this).attr("seg")]+=a(this).outerWidth();p.total+=a(this).outerWidth()});return p}this.addMsg=function(p){if(typeof p=="string"){p=a("<li>"+p+"</li>")}if(!p.attr("id")){p.attr("id","msg"+Math.ceil(Math.random()*99999999))}if(d){b.push(p)}else{c.append(p)}return p.attr("id")};this.removeMsg=function(p){if(typeof p=="string"){p=a("#"+p)}g.push(p)};this.start=function(){if(!d){o()}};this.isScrolling=function(){return(d==true)}}})(jQuery);