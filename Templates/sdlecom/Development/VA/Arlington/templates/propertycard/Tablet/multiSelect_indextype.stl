<#macro displayMultiSelectFilterColumnCount(name, column count)>
 <#assign t1 = pageStyleUtil.addOrSetQuery(searchResult.queryString, "start", null)>
 <#if (!count.isFiltered)>
  <#assign t2 = pageStyleUtil.appendQuery(t1, "q", name + ":\"" + count.columnValue?if_exists + "\"")>
    <input type="checkbox" name="${name}" value="${count.columnValue}" /><a href="?${t2}&searchable=${searchable}&isPhoneticSearch=${isPhoneticSearch}">${count.columnValue}</a>(<span>${count.value}</span>)
    <br/>
 </#if>
</#macro>

<#--
The real rendering is here. Actually, still render it almost similar to a normal narrowBy search
-->

<#assign filterColumn = searchResult.filterResult.getFilterColumn("IndexType")>
<#if (filterColumn?has_content && filterColumn.counts.size()>0) >
 <#assign c = filterColumn.setRendered().column>
 <div class="filter_list"> 
  <p class="filter_head"><span class="active"></span><@displayParentFilteredColumn c />${c.displayName}</p> 
  <div class="filter_body" id="filter_${c.name}" style="display: none; ">
    <#foreach cCount in filterColumn.getTopCounts(500)>
      <@displayMultiSelectFilterColumnCount c.name, c, cCount/>
    </#foreach>
    <form style="display:none">
      <input type="submit" class="button" value="Filter"/>
    </form>
  </div>
 </div>
<br/>
</#if>

<script type="text/javascript" src="<@com.currentUrlPrefix/>/resource/jquery.query.js"></script>
<script type="text/javascript">
$().ready(function(){
  $('#filter_IndexType input').click(function(){
    $('#filter_IndexType form').show('slow');
  });
  $('#filter_IndexType form input').click(function(event){
    event.preventDefault();
    var selections = $.map($('#filter_IndexType input:checked'),function(a){return a.value.replace(",","\\,")}).join(",");
    $.query.REMOVE('start');
    window.location=$.query.set('q', $.query.get('q').toString() + " IndexType:\""+selections+"\"").toString();
  });
});
</script>

