<#assign isDownload = request.getParameter("isDownload") >
<#if searchResult.docs?has_content >
		<#foreach doc in searchResult.docs>
		    <#assign imagelocation = "C:\\temp\\cookimages\\" + doc.get("IMAGENAME")+ ".tif">
		    <#if request.isUserInRole('COOK_ALL_ACCESS') || request.isUserInRole('COOK_ADMIN') || request.isUserInRole('ROAM_ADMIN')>
			<#assign baos  = new("java.io.ByteArrayOutputStream")>
			<#assign converter = new("com.fdt.common.util.TIFFToPDFConverter")>
				<#if (converter.convert(imagelocation + ".burned", "", 159,159,159, baos) == true)> 
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#elseif (converter.convert(imagelocation, "", 0,0,0, baos) == true)>        
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#else>
					<br />
					<br />
					<center><b>Image is Unavailable. Please contact AMCAD Support at support@amcad.com with subject line as <i>Instrument</i> number you are trying to view.</b></center>
					<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
				</#if>
		    <#else>
			<#-- The Request Came For Download -->
				<#if isDownload?has_content && isDownload == "Y">
					<#assign downloadUrl = "/downloadDocument.admin?imagelocation=" + imagelocation + "&waterMarkStr=&waterMarkRedColorCode=159&waterMarkGreenColorCode=159&waterMarkBlueColorCode=159&productkey=" + doc.get("CASENUMBER") + "_" + doc.get("DATE") + "&accessname=COOK_PERPAGE_ACCESS&uniqueidentifier=COOK_PERPAGE_ACCESS&application=AICMS">
					${request.getServletContext().getRequestDispatcher(downloadUrl).forward(request, response)}
				<#else>
					${request.setAttribute("requestImageUrl", "search.do?indexName=imageindex&lq=%23DATE%3A%22" + doc.get('DATE') + "%22~5%23 AND  %23CASENUMBER%3A%22" + doc.get('CASENUMBER') + "%22~5%23" )} 
					<#assign accessImageUrl = "/viewImage.admin?imagelocation=" + imagelocation + "&waterMarkStr=&waterMarkRedColorCode=159&waterMarkGreenColorCode=159&waterMarkBlueColorCode=159&productkey=" + doc.get("CASENUMBER") + "_" + doc.get("DATE") + "&producttype=WARRANT&accessname=COOK_PERPAGE_ACCESS&numberofpages=" + doc.get("PAGECOUNT") + "&isImageAvailable=true&uniqueidentifier=COOK_PERPAGE_ACCESS&application=AICMS">
					${request.getServletContext().getRequestDispatcher(accessImageUrl).forward(request, response)}     
				</#if>	
			</#if>		    
		</#foreach>
<#else>
                   <#if request.getParameter("path") == "chan">
                        <#assign imagelocation = "C:\\temp\\cookimages\\10001.tif">
                   <#elseif request.getParameter("path") == "civil">
                        <#assign imagelocation = "C:\\temp\\cookimages\\20001.tif">
                   <#else>  
                        <#assign imagelocation = "C:\\temp\\cookimages\\30001.tif">
                   </#if>
                   <#assign date = request.getParameter("date")> 
                   <#assign case = request.getParameter("case")> 
		    <#if request.isUserInRole('COOK_ALL_ACCESS') || request.isUserInRole('COOK_ADMIN') || request.isUserInRole('ROAM_ADMIN')>
			<#assign baos  = new("java.io.ByteArrayOutputStream")>
			<#assign converter = new("com.fdt.common.util.TIFFToPDFConverter")>
				<#if (converter.convert(imagelocation + ".burned", "", 159,159,159, baos) == true)> 
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#elseif (converter.convert(imagelocation, "UNOFFICIAL", 0,0,0, baos) == true)>        
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#else>
					<br />
					<br />
					<center><b>Image is Unavailable. Please contact AMCAD Support at support@amcad.com with subject line as <i>Instrument</i> number you are trying to view.</b></center>
					<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
				</#if>
		    <#else>
			<#-- The Request Came For Download -->
				<#if isDownload?has_content && isDownload == "Y">
					<#assign downloadUrl = "/downloadDocument.admin?imagelocation=" + imagelocation + "&waterMarkStr=UNOFFICIAL&waterMarkRedColorCode=159&waterMarkGreenColorCode=159&waterMarkBlueColorCode=159&productkey=${case}_${date}&accessname=COOK_PERPAGE_ACCESS&uniqueidentifier=COOK_PERPAGE_ACCESS&application=AICMS">
					${request.getServletContext().getRequestDispatcher(downloadUrl).forward(request, response)}
				<#else>
					${request.setAttribute("requestImageUrl", "search.do?indexName=imageindex&lq=%23DATE%3A%229999999%22~5%23 AND  %23CASENUMBER%3A%22unique%22~5%23" )} 
					<#assign accessImageUrl = "/viewImage.admin?imagelocation=" + imagelocation + "&waterMarkStr=UNOFFICIAL&waterMarkRedColorCode=159&waterMarkGreenColorCode=159&waterMarkBlueColorCode=159&productkey=${case}_${date}&producttype=WARRANT&accessname=COOK_PERPAGE_ACCESS&numberofpages=1&isImageAvailable=true&uniqueidentifier=COOK_PERPAGE_ACCESS&application=AICMS">
					${request.getServletContext().getRequestDispatcher(accessImageUrl).forward(request, response)}     
				</#if>	
			</#if>
</#if>