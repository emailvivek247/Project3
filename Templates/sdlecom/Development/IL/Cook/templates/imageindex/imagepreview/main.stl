<#assign isDownload = request.getParameter("isDownload") >
<#if searchResult.docs?has_content >
		<#foreach doc in searchResult.docs>
		    <#assign imagelocation = "C:\\temp\\cookimages\\" + doc.get("IMAGENAME")+ ".tif">
			<#assign baos  = new("java.io.ByteArrayOutputStream")>
			<#assign converter = new("com.fdt.common.util.TIFFToPDFConverter")>
                                <#if (converter.convert(imagelocation + ".burned", "Printing Prohibited", 159,159,159, 1, baos) == true)> 
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#elseif (converter.convert(imagelocation, "Printing Prohibited", 0,0,0, 1, baos) == true)>        
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#else>
					<br />
					<br />
					<center><b>Image is Unavailable. Please contact AMCAD Support at support@amcad.com with subject line as <i>Instrument</i> number you are trying to view.</b></center>
					<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
				</#if>		   		    
		</#foreach>
<#else>
                   <#if request.getParameter("path") == "chan">
                        <#assign imagelocation = "C:\\temp\\cookimages\\10001.tif">
                   <#elseif request.getParameter("path") == "civil">
                        <#assign imagelocation = "C:\\temp\\cookimages\\20001.tif">
                   <#else>  
                        <#assign imagelocation = "C:\\temp\\cookimages\\30001.tif">
                   </#if>
                   <#assign date = request.getParameter("date")> 
                   <#assign case = request.getParameter("case")> 
		   
			<#assign baos  = new("java.io.ByteArrayOutputStream")>
			<#assign converter = new("com.fdt.common.util.TIFFToPDFConverter")>
				<#if (converter.convert(imagelocation + ".burned", "Printing Prohibited", 159,159,159, 1, baos) == true)> 
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#elseif (converter.convert(imagelocation, "Printing Prohibited", 0,0,0, 1, baos) == true)>        
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#else>
					<br />
					<br />
					<center><b>Image is Unavailable. Please contact AMCAD Support at support@amcad.com with subject line as <i>Instrument</i> number you are trying to view.</b></center>
					<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
				</#if>		   
</#if>