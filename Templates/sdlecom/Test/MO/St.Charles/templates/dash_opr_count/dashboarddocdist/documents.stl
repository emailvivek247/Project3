<#assign urlEncoder = new("net.javacoding.xsearch.utility.EscapeChars")>
<#if (searchResult.docs?has_content && searchResult.docs.size() > 0) >
 
<#assign yearDataxml = "">
<#assign yearList = "">
<#assign monthDataxmlTemp = "">
<#assign year = 0>
<#assign month = 0>   
<#assign yearDocumentCount = 0>
<#assign monthDocumentCount = "">

<#foreach doc in searchResult.docs>
   <#if (year?number != doc.get("YEAR")?number)>
      <#if (year?number > 0)>            
            <#assign yearList = yearList + "," + year?string + "(" + yearDocumentCount?string + ")">
      </#if>
     <#assign year = doc.get("YEAR")>
     <#assign yearDocumentCount = doc.get("DOCUMENTCOUNT")?number>
   <#else>     
      <#assign yearDocumentCount = yearDocumentCount?number + doc.get("DOCUMENTCOUNT")?number>
   </#if>
</#foreach>
<#assign yearList = yearList + "," + year?string + "(" + yearDocumentCount?string + ")">

<script language="JavaScript">   
  
   var yearList = '${yearList}'.replace(/^,+|,+$/g, "").split(',');
   
   for ( i=0; i < yearList.length; i++ ){
          if (i == yearList.length -1){
            addToSelect("selYears", yearList[i].split("(")[0], yearList[i], "Y");
          }
          else {
            addToSelect("selYears", yearList[i].split("(")[0], yearList[i], "N");
          }
       }
   if (window.innerWidth || window.innerHeight){ 
       docwidth = window.innerWidth; 
       docheight = window.innerHeight; 
   }
   if (document.body.clientWidth || document.body.clientHeight){ 
       docwidth = document.body.clientWidth; 
       docheight = document.body.clientHeight; 
   }   
   docwidth = Math.round(docwidth * 0.9);
   docheight = Math.round(docheight * 0.9);
   if (docwidth < 1000){
       docwidth = 1000;}
   if (docheight < 700){
       docheight = 700;}
 
   getAllDoctypes('${year}');
   

function getStrMonth(intMonth){
     var strMonth;
              if (intMonth == 1){
                  strMonth = "Jan"; 
              }
              else if(intMonth == 2){
                  strMonth = "Feb";  
              }    
              else if(intMonth == 3){
                  strMonth = "March";  
              }    
              else if(intMonth == 4){
                  strMonth = "April";  
              }    
              else if(intMonth == 5){
                  strMonth = "May";  
              }    
              else if(intMonth == 6){
                  strMonth = "June";  
              }    
              else if(intMonth == 7){
                  strMonth = "July";  
              }    
              else if(intMonth == 8){
                  strMonth = "Aug";  
              }    
              else if(intMonth == 9){
                  strMonth = "Sept";  
              }    
              else if(intMonth == 10){
                  strMonth = "Oct";  
              }    
              else if(intMonth == 11){
                  strMonth = "Nov";  
              }    
              else if(intMonth == 12){
                  strMonth = "Dec";  
              }  
       return strMonth;
}

function removeChildNodes(ctrl)
{
  while (ctrl.childNodes[0])
  {
    ctrl.removeChild(ctrl.childNodes[0]);
  }
}


function resetData(){
           document.getElementById('fromBox').length = 0;
           document.getElementById('toBox').length = 0;
           var ctrl;
           ctrl = document.getElementById('docTypeChartDiv');
           removeChildNodes(ctrl);
}
function getAllDoctypes(year){
          var docArray = [];
      
          resetData();
            
          var url = "search.do?searchType=1&indexName=dash_opr_docs&templateName=JSONFIL&q=YEAR:\"" + year + "\"&sortBy=Month&desc=N"; 
            $.getJSON(url,
            function(data){
                objResults = data;                
                $.each(data.filters[2].entries, function(i,item){
                    docArray.push(item.value.toUpperCase());
                });
                docArray.sort();
                for ( i=0; i < docArray.length; i++ ){
                          addToSelect("fromBox", docArray[i], docArray[i], "N");
                }
            });  
}



function compareDoctypes(selectedDocs){
    var docselectionArr = selectedDocs.split(',');
    for ( i=0; i < docselectionArr.length; i++ ){         
         imposeDoctypeTrend(docselectionArr[i]);
    }    
}

function imposeDoctypeTrend(docType){
   
    var selYears = document.getElementById('selYears');
    var year = selYears.options[selYears.selectedIndex].text
    var docArray = new Array(12);
    var doctypeDataXML = "";
    var categories = "<categories>";
    for ( i=1; i <= 12; i++ ){
         categories = categories + "<category label='" + getStrMonth(i) + "' />";
         docArray[i-1] = "<set />";
    }        
      var url = "search.do?searchType=1&indexName=dash_opr_docs&templateName=JSONFIL&q=YEAR:\"" + year + "\"+DOC_TYPE:\"" + docType + "\"&sortBy=Month&desc=N"; 
            $.getJSON(url,
            function(data){
                $.each(data.items, function(i,item){
                           docArray[Math.round(item.Month - 1)] = "<set value='" + item.DOCUMENTCOUNT + "' link='javaScript:openwindow(\"" + year + "\",\"" + item.Month + "\",\"" + docType.toUpperCase() + "\")' />";
                });
                for ( i=0; i < 12; i++ ){
                   doctypeDataXML = doctypeDataXML + docArray[i];
                }          
                categories = categories + "</categories>";
                
                var chartCaption = "Monthly Document Distribution"; 
                
                if (document.getElementById("chart2Id") != null && getChartFromId("chart2Id").getXML() != ""){
                    var chartToPrint = getChartFromId("chart2Id");
                    var doctypeDataXMLprev = chartToPrint.getXML();
                    doctypeDataXMLprev = doctypeDataXMLprev.replace(/\"java/g,'\'java').replace(/\)\"/g,'\)\'');                   
                    doctypeDataXMLprev = doctypeDataXMLprev.replace("</chart>","");
                    doctypeDataXML = doctypeDataXMLprev + "<dataset seriesname='" + docType + "' >" + doctypeDataXML + "</dataset>" + "</chart>";                  
                    var chart3 = new SmartCharts("smartcharts/charts/ScrollLine2D.swf", "chart2Id", (docwidth - 300).toString(), (docheight * 0.9).toString(), "0", "1");
                    chart3.setDataXML(doctypeDataXML);
                    chart3.render(docTypeChartDiv);
                }
                else{
                    var chart3 = new SmartCharts("smartcharts/charts/ScrollLine2D.swf", "chart2Id", (docwidth - 300).toString(), (docheight * 0.9).toString(), "0", "1");
                    doctypeDataXML = categories + "<dataset seriesname='" + docType + "' >" + doctypeDataXML + "</dataset>"; 
                    chart3.setDataXML("<chart caption='Monthly Document Distribution' subCaption='" + year + "' numdivlines='9' lineThickness='2' showValues='0' anchorRadius='3' anchorBgAlpha='50' showAlternateVGridColor='1' showValues='0' decimals='0' formatNumberScale='0' numVisiblePlot='12' animation='0' showAboutMenuItem='0' slantLabels='0' showFCMenuItem='0' imageSave='1' logoURL='resources/images/amcadlogo.png' logoLink='http://www.amcad.com' logoPosition='BR' logoAlpha='50'>" + doctypeDataXML + "</chart>");
                    chart3.render(docTypeChartDiv);  
                }
                               
            });
      
}

function removeDoctype(docTypes){
    var doctypeArr = docTypes.split(',');
    if (document.getElementById("chart2Id") != null && getChartFromId("chart2Id").getXML() != ""){
         var chartToPrint = getChartFromId("chart2Id");
         var doctypeDataXMLprev = chartToPrint.getXML();        
         var datasetArray = doctypeDataXMLprev.split('<dataset');
         for ( i=0; i < datasetArray.length ; i++ ){
             for (j=0; j < doctypeArr.length; j++ ){
                  if (datasetArray[i].match(doctypeArr[j])){ 
                       var matchStr = '<dataset' + datasetArray[i].replace('</chart>','');                                                              
                       var doctypeDataXMLprev = doctypeDataXMLprev.replace(matchStr,'');                        
                  } 
             } 
             
         }
         doctypeDataXMLprev = doctypeDataXMLprev.replace(/\"java/g,'\'java').replace(/\)\"/g,'\)\'');
         var chart3 = new SmartCharts("smartcharts/charts/ScrollLine2D.swf", "chart2Id", (docwidth - 300).toString(), (docheight * 0.9).toString(), "0", "1");
         chart3.setDataXML(doctypeDataXMLprev);
         chart3.render(docTypeChartDiv);
     }
}


</script>

<#else>
 <#include "noResults.stl"> 
</#if>