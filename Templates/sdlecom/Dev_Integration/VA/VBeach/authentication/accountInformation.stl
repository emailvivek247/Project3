<#include "/admin/lib/include.stl" />
<@loginLayout encoding="utf-8">
<#assign form  =JspTaglibs["http://www.springframework.org/tags/form"]>
<#assign spring=JspTaglibs["http://www.springframework.org/tags"]>
<link rel="stylesheet" href="resources/styles/validationEngine.jquery.css" type="text/css" />
<link rel="stylesheet" href="resources/styles/login.css" />
<link rel="stylesheet" href="resources/styles/jquery-ui-1.8.11.base.css" />
<link rel="stylesheet" href="resources/styles/jquery-ui-custom-ext.css" />
<link rel="stylesheet" href="resources/styles/vtabs.css" />
<script type="text/javascript" src="resources/javascripts/jquery.min.js"/></script>
<script type="text/javascript" src="resources/javascripts/jquery-ui.min.js"/></script>
<script type="text/javascript" src="resources/javascripts/jquery.validationEngine-en.js"></script>
<script type="text/javascript" src="resources/javascripts/jquery.validationEngine.js"></script>
<script type="text/javascript" src="resources/javascripts/jquery.cookie.js"></script>

<style>
div.ADCSI {
	width: 90%;
}
span.ADCSI_leftcol {
	width: 200px;
	text-align:right;
	display: inline-block;
}
#vtab > ul > li.accountSummary {
    background: url('resources/styles/images/summary.png') no-repeat center center;
}
#vtab > ul > li.userInfo {
    background: url('resources/styles/images/editUser.png') no-repeat center center;
}
#vtab > ul > li.userAccountSettings {
    background: url('resources/styles/images/accountSettings.png') no-repeat center center;
}
#vtab > ul > li.userPaymentInfo {
    background: url('resources/styles/images/paymentInfo.png') no-repeat center center;
}
.ui-button-text {
	color:white;
}
table#subscriptionDetails {
	border-collapse: collapse;
	margin: 10px 10px 20px 10px;
}

table#subscriptionDetails td {	
	padding: 5px 5px;
}

.paid {	
	color: #527838;
}

.unPaid {	
	color: #ED1C43;
}

th.header{
	color: #039;
	border-bottom: 2px solid #6678B1;
	padding: 5px 5px;
}

td.header{
	color: #039;
	border-bottom: 2px solid #6678B1;
	padding: 5px 5px;
}

td.footer{
	color: #039;
	border-top: 2px solid #6678B1;
	padding: 5px 5px;
}
#pay {
	background: #55a003 url(resources/styles/images/greenGrad.png) 50% 50% repeat-x;
	color: white;
}
#pay:hover {
	background: #55a003 url(resources/styles/images/greenGrad.png) 50% 50% repeat-x;
	color: white;
}
table#accountInfo {
	text-align:left;	
	border-collapse: collapse;
	margin: 10px 10px 20px 30px;
}
table#accountInfo td {	
	padding: 5px 40px 5px 10px;
}
th.subheader{
	color: #039;
	border-top: 1px solid #6678B1;
	padding: 5px 5px;
}
.myButton {
	position: relative;   /* position parent container so children are relative to me */
	width: 200px;         /* positioned elements should have width */
	height: 200px;        /* positioned elements should have height */	
	float: left;          /* so that multiple instances go next to each other */
	text-decoration: none;
	}

.myButton img, .myButton p {
	position: absolute;  /* position is absolute, relative to the parent a.myButton tag */
	top: 0px;            /* top of element should be 0px from parent element top */
	border: none;        /* remove border (specifically on img), just looks better */
}
.myButton p {
	left: 35px;        /* assumes images are 300px wide */
	margin-top: 10px;    /* removes default top margin on p */
}
.extLink {
	background: #55a003 url(resources/styles/images/greenGrad.png) 50% 50% repeat-x;
	color: #ffffff;
}
.header {
	text-align:center;
}
.right {
	text-align:right;
}
</style>
<#if request.getServletContext().getInitParameter("isShoppingCartEnabled") == "true">
	<#assign shoppingCartSize = pageStyleUtil.getshoppingCartSize(request)>
</#if>
	<div class="content">
		<div style="width:80%; margin-left: auto;margin-right:auto;margin-top:100px;">
			<div id="ADCSI" class="ADCSI" style="margin-top: 0px; margin-bottom: 12px;">
			<div class="ADCSI_title" id="ADCSI_title">				
				<span style="width:49%;text-align:left;display:inline-block;"><b><@spring.message code="form.name.accountInformation" /></b></span>
				<span style="width:49%;text-align:right;display:inline-block;">
				<#if request.getServletContext().getInitParameter("isShoppingCartEnabled") == "true">
					<a href="reviewShoppingCart.admin" style="margin-right:4px;" class="inactive headerItem" ><img src="resources/images/shoppingCart.png" /><span id="shoppingCartItems"><#if shoppingCartSize = 0>  Shopping cart is Empty<#else>${shoppingCartSize}  Item(s) in the Shopping Cart</#if></span></a> |  
				</#if>
					<a href="logout.admin"><@spring.message code="security.authentication.logout" /></a>&nbsp;(${user.username})</a></span>
			</div>		
			    <table style="width:100%">				
				<tr>				
					<td style="width:100%;vertical-align:top;">	
							<#assign totalDue = 0 >
							<#if subscriptions?has_content>
								<#list subscriptions as subscription >
								<#if subscription.isPayMentPending() && subscription.isAuthorized() && !subscription.isAccessOverridden()>
									<#assign totalDue = totalDue + subscription.subscriptionFee >
								</#if>
								</#list>
							</#if>
								
							<table id="accountInfo">
								<tr>
									<td valign="top">
										<p><b>${user.firstName}&nbsp;${user.lastName}</b></p>										 
										<p><b><@spring.message code="security.authentication.password" /></b>&nbsp;********&nbsp;<a href="viewChangePassword.admin"><@spring.message code="security.authentication.update" /></a></p>
										<p><b><@spring.message code="security.ecommerce.label.userCreatedDate" />&nbsp;</b>${user.createdDate?string("EEE, MMM d, yyyy")}</p>
										<p><b><@spring.message code="security.authentication.lastLogin" /></b>&nbsp;${user.lastLoginTime?string("EEE, MMM d, yyyy, hh:mm:ss a")}</p>
										<p><a href="publicTerms.admin" target="_blank"><@spring.message code="security.authentication.roamTerms" /></a></p>
										<p>
											<b><@spring.message code="security.ecommerce.totalAmountDue" /></b>
									         <#if totalDue &gt; 0>
							            		<span class="unPaid"><b>${totalDue?string.currency}</b>&nbsp;&nbsp;</span>
							            		<#if request.getServletContext().getInitParameter("isDBService") == "true">
							            			<a id="pay" href="paymentInfo.admin"><@spring.message code="security.ecommerce.payNow" /></a>
							            		<#else>
							            			<#if user.isCardAvailable()>
							            				<a id="pay" href="paymentInfo.admin"><@spring.message code="security.ecommerce.payNow" /></a>
							            			<#else>
							            				<a class="extLink" href="viewAccountInformation.admin?return_url=${request.getRequestURL()}"><@spring.message code="security.ecommerce.label.addPaymentInformation" /></a>
							            			</#if>							            			
							            		</#if>
							            	 <#else>
							                	<span class="paid"><b>$0.00</b></span>	
							                 </#if>
										</p>
									</td>
									<#if user.isCardAvailable()>
									<td valign="top">
										<#if request.getServletContext().getInitParameter("isDBService") == "true">
										<p><b><@spring.message code="security.ecommerce.label.cardOnFile" /></b>&nbsp;****${user.getCreditCard().number} <a href="ccinfo.admin"><@spring.message code="security.authentication.update" /></a></p>
										<#else>
										<p><b><@spring.message code="security.ecommerce.label.cardOnFile" /></b>&nbsp;********${user.getCreditCard().number} 
										<a href="viewAccountInformation.admin?return_url=${request.getRequestURL()}"><@spring.message code="security.authentication.update" /></a></p>
										</#if>
										<p><b><@spring.message code="security.ecommerce.label.cardStatus" /></b>&nbsp;<#if user.isCreditCardActive()><span class="paid"><@spring.message code="security.ecommerce.label.active" /></span><#else><span class="unPaid"><@spring.message code="security.ecommerce.label.expired" /></span></#if></p>																				 
									</td>
									</#if>
									<#if request.getServletContext().getInitParameter("isDBService") == "false" && !user.isCardAvailable()>
									<td valign="top">
										<p><b><@spring.message code="security.ecommerce.label.cardOnFile" /></b>&nbsp;<@spring.message code="security.ecommerce.label.none" /> <a href="viewAccountInformation.admin?return_url=${request.getRequestURL()}"><@spring.message code="security.ecommerce.label.addPaymentInformation" /></a></p>
									</td>
									</#if>
								</tr>								
							</table>
							<#if subscriptions?has_content>							
							<div class="ADCSI_row">							
							<span class="ADCSI_rightcol" style="width: 100%; display: inline-block; ">								
								<table width="95%" id="subscriptionDetails">
								<tr ><td class="header" colspan="10"><@spring.message code="security.ecommerce.currentSubscriptions" /></td></tr>
								<th class="header" width="100px"><@spring.message code="security.ecommerce.label.site" /></th>
								<th class="header" width="300px"><@spring.message code="security.ecommerce.label.subscription" /></th>
								<th class="header" width="100px"><@spring.message code="security.ecommerce.label.isAuthorizationRequired" /></th>
								<th class="header" width="100px"><@spring.message code="security.ecommerce.label.accessAuthorizationStatus" /></th>
								<th class="header" width="60px"><@spring.message code="security.ecommerce.label.fee" /></th>
								<th class="header" width="110px"><@spring.message code="security.ecommerce.label.paymentStatus" /></th>
								<th class="header" width="110px"><@spring.message code="security.ecommerce.label.subscriptionStatus" /></th>
								<th class="header" width="120px"><@spring.message code="security.ecommerce.label.lastBillingDate" /></th>
								<th class="header" width="120px"><@spring.message code="security.ecommerce.label.nextBillingDate" /></th>
								<th class="header" width="100px"><@spring.message code="security.ecommerce.label.Action" /></th>								
								<#list subscriptions as subscription >								
								<#if (subscription.isPayMentPending() && !subscription.isAccessOverridden()) || subscription.isMarkedForCancellation>
									<tr class="unPaid">
								<#else>
									<tr class="paid">
								</#if>
									<td class="center">${subscription.siteName}</td>
									<td class="center">${subscription.subscription}</td>
									<td class="center"><#if subscription.isAuthorizationRequired()><@spring.message code="security.ecommerce.label.yes" /><#else><@spring.message code="security.ecommerce.label.no" /></#if></td>
									<td class="center"><#if subscription.isAuthorized()><@spring.message code="security.ecommerce.label.authorized" /><#else><@spring.message code="security.ecommerce.label.pending" /></#if></td>
									<td class="right">
										<#if subscription.isAccessOverridden()&& !subscription.isAccessOverridden()>
											<@spring.message code="security.ecommerce.label.na" />
										<#else>	
											${subscription.subscriptionFee?string.currency}
										</#if>	
									</td>
									<td class="center">
										<#if subscription.subscriptionFee = 0 >
											<@spring.message code="security.ecommerce.label.free" />
										<#elseif subscription.subscriptionFee &gt; 0 >
											<#if subscription.isPayMentPending() >	
												<#if subscription.isAuthorized()>											
													<@spring.message code="security.ecommerce.label.paymentDue" />												
												<#elseif !subscription.isAuthorized()>
													<@spring.message code="security.ecommerce.label.authorizationRequiredtoPay" />
												</#if>
																							
											<#else>
												<#if subscription.category = 'NON_RECURRING_SUBSCRIPTION'>
													<@spring.message code="security.ecommerce.label.payasyougo" />	
												<#else>
													<@spring.message code="security.ecommerce.label.paid" />
												</#if>												
											</#if>
										</#if>		
									</td>					
									<td class="center">
										<#if subscription.isMarkedForCancellation && !subscription.isAccessOverridden()>
											<@spring.message code="security.ecommerce.label.markedForCancellationStatus" />										
										<#elseif subscription.isPayMentPending() && !subscription.isAccessOverridden()>
											<@spring.message code="security.ecommerce.label.inActive" />
										<#elseif !subscription.isPayMentPending() && !subscription.isAccessOverridden()>	
											<@spring.message code="security.ecommerce.label.active" />
										<#elseif subscription.isAccessOverridden()&& !subscription.isAccessOverridden()>
											<@spring.message code="security.ecommerce.label.na" />	
										</#if>
									</td>
									<td class="center"><#if subscription.lastBillingDate?has_content>${subscription.lastBillingDate?date}<#else ><@spring.message code="security.ecommerce.label.na" /></#if ></td>
									<td class="center"><#if subscription.nextBillingDate?has_content && !subscription.isMarkedForCancellation>${subscription.nextBillingDate?date}<#else ><@spring.message code="security.ecommerce.label.na" /></#if ></td>
									<td class="center"><a href="getSubscriptionDetails.admin?uaId=${subscription.accessId}"><img src="resources/images/manage.png" /><@spring.message code="security.ecommerce.label.manage" /></a></td>
								</tr>																	
						        </#list>						
						        </table>						        			    	   			
						        <#else>
						        	<p><span style="vertical-align: middle;text-align:center;margin-left: 30px;"><@spring.message code="security.ecommerce.label.noSubscriptions" /></span></p>
								</#if>
								<a href="viewAvailableSubscriptions.admin" class="myButton">
									<img border="0" title='<@spring.message code="security.ecommerce.label.addNewSubscriptions" />' src="resources/images/AddSubscriptions.png" />
									<p><@spring.message code="security.ecommerce.label.addNewSubscriptions" /></p>
								</a>
								<a href="paymenthistory.admin" class="myButton">
									<img border="0" title='<@spring.message code="security.ecommerce.label.paymentHistory" />' src="resources/images/history.png" />
									<p><@spring.message code="security.ecommerce.label.viewPaymentHistory" /></p>
								</a>
								<#-- 
								<a href="getUserAlerts.admin" class="myButton">
									<img border="0" title='<@spring.message code="security.Alerts.label.viewUserAlerts" />' src="resources/images/history.png" />
									<p><@spring.message code="security.Alerts.label.viewUserAlerts" /></p>
								</a>
								-->							
								
					</td>
				</tr>
			</table>			  
	<div class="ADCSI_title" id="ADCSI_title">
				<#if subscriptions?has_content>
					<div style="width:1150px;text-align:center;display:inline-block;"></div>	
					<div style="width:1150px;text-align:center;display:inline-block;">
						<a href="checkSubscription.admin"><@spring.message code="security.ecommerce.label.continueToSearchPage" />
						<img style="border:0px;" src="resources/images/continueSearch.png"/></a>
					<div>
				</#if>				
					</div>
	</div>

<script type="text/javascript">
		$(function() {
			//$( ".action" ).button({
	        //    icons: {
	        //        primary: "ui-icon-transferthick-e-w"
	        //    }
	        //});	 
	        $( "#pay" ).button({
	            icons: {
	                primary: "ui-icon-cart"
	            }
	    });	    
	    $( ".extLink" ).button();   
		});	
	$(document).ready(function(){
	    var $items = $('#vtab>ul>li');
		$items.click(function() {
		    $items.removeClass('selected');
		    $(this).addClass('selected');
		
		    var index = $items.index($(this));
		    var url = $(this).find('a').attr('href');
		    if (url !="") {
		    	$('#vtab>div').hide().eq(index).show().load(url);
		    } else {
		    	$('#vtab>div').hide().eq(index).show();
		    }	
		    $('#ccinfo-form').validationEngine('hide');	
		}).eq(0).click();
	});
</script>
</@loginLayout>