<#if request.isUserInRole('VABEACH_IMAGE_ACCESS') || request.isUserInRole('VABEACH_ADMIN') || request.isUserInRole('ROAM_ADMIN')>
<#if searchResult.docs?has_content>
    <#foreach doc in searchResult.docs>
         <#assign imagelocation = "\\\\" + doc.get("Server") + "\\" +  doc.get("Path") + "\\" + doc.get("Booktype") + "\\" + doc.get("BookName") + "\\" + doc.get("IndexName") + "\\" + doc.get("Book") + "\\" + doc.get("Image")>
         <#assign baos = new("java.io.ByteArrayOutputStream")> 
         <#assign converter = new("com.fdt.common.util.TIFFToPDFConverter")>
        <#if (converter.convert(imagelocation, "", 159,159,159, baos) == true)> 
            ${response.reset()}
            ${response.resetBuffer()}
            ${response.setContentType("application/pdf")}
            ${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
            ${response.setHeader("Expires", " 0")}
            ${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
            ${response.setHeader("Pragma" , "public")}      
            ${baos.writeTo(response.getOutputStream())}
            ${response.getOutputStream().flush()}

        <#else>
            <br>
            <br>
            <center><b>Image is Unavailable.</b></center>
            <center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
        </#if>
    </#foreach>
  <#else>
    <br />
    <br />
    <center><b>Image is Unavailable. Please contact AMCAD Support at support@amcad.com with subject line as <i>Instrument</i> number you are trying to view.</b></center>
    <center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center> 
  </#if> 
  </#if> 