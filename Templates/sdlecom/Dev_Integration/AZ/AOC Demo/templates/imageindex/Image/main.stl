<#if (request.getRemoteUser() == "demouser1@amcad.com" || request.getRemoteUser() == "demouser55@amcad.com") && request.isUserInRole('AOC_VOLUME_ACCESS_LIMIT1')>
<html><head><title>Warrant Search</title>
<meta http-equiv="content-type" content="text/html; charset=${encoding}">
<link rel="stylesheet" href="<@com.currentUrlPrefix/>/resource/theme-base.css" type="text/css" media="print, projection, screen" />
<link rel="stylesheet" href="<@com.currentUrlPrefix/>/resource/theme-glossy-blue.css" type="text/css" media="print, projection, screen" />
<link rel="stylesheet" href="<@com.currentUrlPrefix/>/resource/export.css" type="text/css" media="print, projection, screen" />
<link rel="stylesheet" href="<@com.currentUrlPrefix/>/resource/calendar.css" type="text/css" media="print, projection, screen" />
<link rel="stylesheet" href="<@com.currentUrlPrefix/>/resource/prompt.css" type="text/css" media="print, projection, screen" />
<link rel="stylesheet" href="templates/resources/basket.css" type="text/css" media="projection, screen" />
<script type="text/javascript" src="<@com.currentUrlPrefix/>/resource/jquery.js"></script>
<script type="text/javascript" src="<@com.currentUrlPrefix/>/resource/prompt.js"></script>
<script type="text/javascript" src="<@com.currentUrlPrefix/>/resource/sdl-min.js"></script>
<script type="text/javascript" src="<@com.currentUrlPrefix/>/resource/calendar_us.js"></script>
<script type="text/javascript" src="<@com.currentUrlPrefix/>/resource/jquery.tablesorter.js"></script>
<link rel="shortcut icon" href="favicon.ico"/>
</head>
   
     <body style="background:#E7E7E7;width:100%">
     <#include "/templates/globalNav_AOC.stl">
     <div style="width:100%;padding-top:100px;text-align:center;font-size:1em;font-weight:bold">
        <div style="width:100%">
            You have reached your limit on the number of the pages you can view during the current subscription period. 
            <br />If you would like to view more image you can upgrade your current subscription by accessing your account information page.
            <br /><br /><br />To upgrade your subscription,
                <br /><br />Go to Account Information Page.
                <br />Click on "Manage" Link associated with your current subscription.
                <br />Select the subscription you want to upgrade to from the list of the available subscriptions and click on Change Subscription.
               <br />Click on "Confirm and Change" to upgrade your subsciption and continue accessing images.
             
        </div>
     </div>
     </body>
<#else>
<#assign isDownload = request.getParameter("isDownload") >
<#if searchResult.docs?has_content >
		<#foreach doc in searchResult.docs>
		    <#assign imagelocation = "C:\\Images\\casemanagement.tif">
		    <#if request.isUserInRole('AOC_VOLUME_ACCESS_AUTH') || request.isUserInRole('AOCIMAGEACCESS_ADMIN') || request.isUserInRole('ROAM_ADMIN')|| request.isUserInRole('AOC_VOLUME_ACCESS_LIMIT1') || request.isUserInRole('AOC_VOLUME_ACCESS_LIMIT2') || request.isUserInRole('AOC_VOLUME_ACCESS_NOLIMIT')>
			<#assign baos  = new("java.io.ByteArrayOutputStream")>
			<#assign converter = new("com.fdt.common.util.TIFFToPDFConverter")>
				<#if (converter.convert(imagelocation + ".burned", "UNOFFICIAL", 159,159,159,0,0,true,baos,false,1) == true)> 
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#elseif (converter.convert(imagelocation, "UNOFFICIAL", 159,159,159,0,0,true,baos,false,1) == true)>        
					${response.reset()}
					${response.resetBuffer()}
					${response.setContentType("application/pdf")}
					${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
					${response.setHeader("Expires", " 0")}
					${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
					${response.setHeader("Pragma" , "public")}      
					${baos.writeTo(response.getOutputStream())}
					${response.getOutputStream().flush()}
				<#else>
					<br>
					<br>
					<center><b>Image is Unavailable. Please contact AMCAD Support at support@amcad.com with subject line as <i>Instrument</i> number you are trying to view.</b></center>
					<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
				</#if>
		    <#else>
			<#-- The Request Came For Download -->
				<#if isDownload?has_content && isDownload == "Y">
					<#assign downloadUrl = "/downloadDocument.admin?imagelocation=" + imagelocation + "&waterMarkStr=UNOFFICIAL&waterMarkRedColorCode=159&waterMarkGreenColorCode=159&waterMarkBlueColorCode=159&productkey=" + doc.get("Instrument") + "&uniqueidentifier=AOC_PERPAGE_ACCESS&application=AILIS">
					${request.getServletContext().getRequestDispatcher(downloadUrl).forward(request, response)}
				<#else>
					${request.setAttribute("requestImageUrl", "search.do?indexName=imageindex&lq=Instrument:" + doc.get('Instrument'))} 
					<#assign accessImageUrl = "/viewImage.admin?imagelocation=" + imagelocation + "&waterMarkStr=UNOFFICIAL&waterMarkRedColorCode=159&waterMarkGreenColorCode=159&waterMarkBlueColorCode=159&productkey=" + doc.get("Instrument") + "&producttype=WARRANT&accessname=AOC_PERPAGE_ACCESS&numberofpages=10&isImageAvailable=true&uniqueidentifier=AOC_PERPAGE_ACCESS&application=AILIS">
					${request.getServletContext().getRequestDispatcher(accessImageUrl).forward(request, response)}     
				</#if>	
			</#if>		    
		</#foreach>
<#else>
     <#if request.isUserInRole('AOC_VOLUME_ACCESS_AUTH') || request.isUserInRole('AOCIMAGEACCESS_ADMIN') || request.isUserInRole('ROAM_ADMIN')|| request.isUserInRole('AOC_VOLUME_ACCESS_LIMIT1') || request.isUserInRole('AOC_VOLUME_ACCESS_LIMIT2') || request.isUserInRole('AOC_VOLUME_ACCESS_NOLIMIT')>
          <img title="Preview" src="<@com.currentUrlPrefix/>/blank.png">
     <#else> 
	${request.setAttribute("requestImageUrl", "search.do?indexName=imageindex&lq=Instrument:")}
	<#assign accessImageUrl = "/viewImage.admin?imagelocation=&waterMarkStr=UNOFFICIAL&waterMarkRedColorCode=159&waterMarkGreenColorCode=159&waterMarkBlueColorCode=159&productkey=&producttype=&accessname=AOC_PERPAGE_ACCESS&numberofpages=0&isImageAvailable=true&uniqueidentifier=AOC_PERPAGE_ACCESS&application=AILIS">
	${request.getServletContext().getRequestDispatcher(accessImageUrl).forward(request, response)} 
     </#if>
</#if>
</#if>