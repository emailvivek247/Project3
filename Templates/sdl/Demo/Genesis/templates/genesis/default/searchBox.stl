<#--Link jquery files for textbox/dropdown combo box-->

<#--Style for textbox/dropdown combo box-->
<style>
 /* HOVER STYLES */
div#nameStartsPopUp {
	display: none;
	position: absolute;
	width: 280px;
	padding: 10px;
	background: #fff;
	color: #000000;
	border: 3px solid #7EB544;
	font-size: 80%;
	z-index: 1;
	float: right;
	text-align:justify;
}
div#nameContainsPopUp {
	display: none;
	position: absolute;
	width: 280px;
	padding: 10px;
	background: #fff;
	color: #000000;
	border: 3px solid #7EB544;
	font-size: 80%;
	z-index: 1;
	float: right;
	text-align:justify;
}

div#nameExactPopUp {
	display: none;
	position: absolute;
	width: 280px;
	padding: 10px;
	background: #fff;
	color: #000000;
	border: 3px solid #7EB544;
	font-size: 80%;
	z-index: 1;
	float: right;
	text-align:justify;
}   
    
</style>

<script type="text/javascript">

// *Set values for searchable fields



    function unique(arrayName) {
        var newArray=new Array();
        label:for(var i=0; i<arrayName.length;i++ )
        {  
            for(var j=0; j<newArray.length;j++ ) {
                if(newArray[j].name == arrayName[i].name) 
                 continue label;
            }
            setCookie('default' + arrayName[i].name, jQuery.trim(arrayName[i].value), 0);
            if ((arrayName[i].type == 'text' || arrayName[i].type == 'select-one') && jQuery.trim(arrayName[i].value).length != 0) {
                newArray[newArray.length] = arrayName[i];
            }
        }
            setCookie('defaultfrmDateProcessed', document.getElementById('frmDateProcessed').value, 0);
            setCookie('defaulttoDateProcessed',  document.getElementById('toDateProcessed').value, 0);
        return newArray;
    }   
    function postAdvancedSearch() {
        try {
          if ($('input[name=searchkindName]:checked').val() == null || $('input[name=searchkindName]:checked').val() == "") {
              $('input[name=searchkindName]:nth(0)').attr("checked","checked");
          }
            if (!doDateCheck('frmDateProcessed','toDateProcessed'))return;          
            document.getElementById("q").value = '';
            var inputElemenets =  $('input[type="text"]');
            var elem = unique(inputElemenets);
            var searchString = '';
            var searchQuery = '';
            var andOrClause ='';
            var doubleQuotes = '"';
            var counter = 0;
            var textcounter = 0;
            var searchValue = '';
            var searchValueQuery = '';
            var hasSpecialNames = 'N';
           var enhancingValue = '';
            for(var i = 0; i < elem.length; i++) {
                if (document.getElementById(elem[i].name + '_select') != null) {
                    counter++;
                }                   
            }
          setCookie('searchkindName', $('input[name=searchkindName]:checked').val(), 0);
            for(var i = 0; i < elem.length; i++) {
                if (document.getElementById(elem[i].name + '_select') != null) {
                    setCookie('default' + elem[i].name + '_select', document.getElementById(elem[i].name + '_select').selectedIndex, 0);
                    textcounter++
                    if (textcounter == counter) {
                        andOrClause = '';
                    } else {
                        andOrClause = ' ' + document.getElementById(elem[i].name + '_select').value + '  ';
                    }
                    if (elem[i].name == 'DateProcessed') {
                        searchValue = getDateQuery(elem[i].name);
                        searchValueQuery = getDateSearchQuery(elem[i].name);
          } else if (elem[i].name == 'EntityName') {
                  if ($('input[name=searchkindName]:checked').val() == 'ExactName') {
                      searchValue = 'EntityNameExact' + ':' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes + '~5';
                      searchValue = '#' + searchValue + '#';
                      searchValueQuery = 'Name' + ':' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes;
  
  		} else if ($('input[name=searchkindName]:checked').val() == 'ContainsName') {
  		    searchValue = elem[i].name + ':' + doubleQuotes + '*' + jQuery.trim(elem[i].value) + '*' + doubleQuotes + '#';
  		    searchValue = '#' + searchValue + '#';
  		    searchValueQuery = 'Name' + ':' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes; 
  
  		} else if ($('input[name=searchkindName]:checked').val() == 'StartsName') {
  		    searchValue = 'EntityNameStarts' + ':' + doubleQuotes + jQuery.trim(removeNonAlphaNumCharEndWildCard(elem[i].value)) + doubleQuotes + '~5';
  		    searchValue = '#' + searchValue + '#';
  		    searchValueQuery = 'Name' + ':' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes;    
  
  		} 
  
  		} else {
                        searchValue = elem[i].name + ':' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes + '~5';
                        searchValue = '#' + searchValue + '#';
                        searchValueQuery = elem[i].title + ':' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes;
                    }
                    searchString = searchString + searchValue + andOrClause;
                    searchQuery = searchQuery  + searchValueQuery + andOrClause;
                }
            }
            document.getElementById("lq").value = searchString;
            document.getElementById("searchQuery").value = searchQuery;
            document.search_${searchResult.indexName}.method = "get";
            document.search_${searchResult.indexName}.action = "search.do";
            document.search_${searchResult.indexName}.searchType.value = "2";           
             
            if (document.getElementById('advancedSortOrder').value.indexOf("|") != -1) {
                document.getElementById("sortBy").value = document.getElementById('advancedSortOrder').value.split('|')[0]; 
                document.getElementById("desc").value = document.getElementById('advancedSortOrder').value.split('|')[1]; 
            } else {
                document.getElementById("sortBy").value = document.getElementById('advancedSortOrder').value; 
            }
            setCookie('adso', document.getElementById('advancedSortOrder').value, 0);
                document.search_${searchResult.indexName}.submit();
        } catch (err) {
            alert(err.message);
        }
    } 
    



      
    function postBasicSearch() {
        try {   
            setCookie('default' + document.getElementById("q").name, document.getElementById("q").value, 0);
            document.getElementById("lq").value = '';
            document.search_${searchResult.indexName}.method = "get";
            document.getElementById('searchQuery').value = document.getElementById('q').value
            document.search_${searchResult.indexName}.action = "search.do";
            document.search_${searchResult.indexName}.searchType.value = "1";
            
            document.getElementById("isPhoneticSearch").value = "1";
                if (document.getElementById('basicSortOrder').value.indexOf("|") != -1) {
                  document.getElementById("sortBy").value = document.getElementById('basicSortOrder').value.split('|')[0]; 
                  document.getElementById("desc").value = document.getElementById('basicSortOrder').value.split('|')[1]; 
                } else {
                  document.getElementById("sortBy").value = document.getElementById('basicSortOrder').value; 
                }
            setCookie('bso', document.getElementById('basicSortOrder').value, 0);
            document.search_${searchResult.indexName}.submit();
        } catch (err) {
            alert(err.message);
        }
    }
    
    	     function removeNonAlphaNumChar(input) {
    		var re = new RegExp($("#regex").val(), "g");
    		input = input.replace(re, "");
    		input = "*" + input + "*";
    		return input;
    	      }
    
    	      function removeNonAlphaNumCharRetainSpaces(input) {
    	    	var re = new RegExp($("#regexwithspaces").val(), "g");
    	    	input = input.replace(re, "");
    	   	input = input.replace(/ /g, "* *");
    		return input;
    	      }
    
    	      function removeNonAlphaNumCharNoWildCard(input) {
    		var re = new RegExp($("#regex").val(), "g");
    	        input = input.replace(re, "");
    	        return input;
    	      }
    
    	      function removeNonAlphaNumCharEndWildCard(input) {
    	    	var re = new RegExp($("#regex").val(), "g");
    	    	input = input.replace(re, "");
    	    	input = input + "*";
    	    	return input;
            } 
            
            
//* Add to clear search results

function clearSearchResults()  
            {   
            document.getElementById("q").value = ""; 
            }

<#-- Start Function for name search pop up messages-->
<#--Starts with name-->
$(function() {
        var moveLeft = 15;
        var moveDown = -125;
        
        $('span#nameStarts').hover(function(e) {
          $('div#nameStartsPopUp').show();
          //.css('top', e.pageY + moveDown)
          //.css('left', e.pageX + moveLeft)
          //.appendTo('body');
        }, function() {
          $('div#nameStartsPopUp').hide();
        });
        
        $('span#nameStarts').mousemove(function(e) {
          $("div#nameStartsPopUp").css('top', e.pageY + moveDown).css('left', e.pageX + moveLeft);
        });
        
      });
 
 <#--Contains name-->
 $(function() {
         var moveLeft = 15;
         var moveDown = -125;
         
         $('span#nameContains').hover(function(e) {
           $('div#nameContainsPopUp').show();
           //.css('top', e.pageY + moveDown)
           //.css('left', e.pageX + moveLeft)
           //.appendTo('body');
         }, function() {
           $('div#nameContainsPopUp').hide();
         });
         
         $('span#nameContains').mousemove(function(e) {
           $("div#nameContainsPopUp").css('top', e.pageY + moveDown).css('left', e.pageX + moveLeft);
         });
         
      });

<#--Exact name-->
$(function() {
        var moveLeft = 15;
        var moveDown = -125;
        
        $('span#nameExact').hover(function(e) {
          $('div#nameExactPopUp').show();
          //.css('top', e.pageY + moveDown)
          //.css('left', e.pageX + moveLeft)
          //.appendTo('body');
        }, function() {
          $('div#nameExactPopUp').hide();
        });
        
        $('span#nameExact').mousemove(function(e) {
          $("div#nameExactPopUp").css('top', e.pageY + moveDown).css('left', e.pageX + moveLeft);
        });
        
      });
</script>
<form name="search_${searchResult.indexName}" id="search_${searchResult.indexName}">
    <input type="hidden" name="indexName" value="${searchResult.indexName}">
    <input type="hidden" name="templateName" value="${searchResult.templateName}">
    <input type="hidden" name="searchQuery" id="searchQuery">
    <input type="hidden" name="lq" id="lq">
    <input type="hidden" name="searchType" id="searchType" value="${Request.searchForm.searchType}">
    <input type="hidden" name="regex" id="regex" value="[^a-zA-Z0-9_]">
    <input type="hidden" name="regexwithspaces" id="regexwithspaces" value="[^a-zA-Z0-9\s_]">
    <input type="hidden" name="sortBy" id="sortBy" value="">
    <input type="hidden" name="desc" id="desc" value="">
    <input type="hidden" name="asc" id="asc" value="">

<#-- *Add searchable parameter -->
    <input type="hidden" name="searchable" id="searchable">
    <input type="hidden" name="isPhoneticSearch" id="isPhoneticSearch">
 
    <label style="display:none;" for="totalResults">${total?if_exists}</label>
 
 
 <#-- *Add table for ROAM image -->
             <table  align="center" border="0" style="margin-bottom:30px;margin-top:30px;">         
		       <tr>
			     <td align="center">
			     <a href ="http://www.amcad.com/solutions-and-services/records-management/roam"><img src="templates/genesis/default/resource/ROAM.png" border="0" width="200px"/></a> 
				<img src="templates/genesis/default/resource/genesis.gif" border="0"/>
			     </td>
		       </tr>
	       </table>
    
        <#if Request.searchForm.searchType = "1">
            <div id="basicSearch">
        <#else>
            <div id="basicSearch" style="display:none">
        </#if>

<#-- *Add table for links next to search button -->
           
<table border="0" align="center" width="100%" cellspacing="0" cellpadding="0">
<tr>
<td rowspan="2" width="33%" align="center"></TD>
<td width="1%" align="center"></TD>
<td rowspan="2" width="33%" align="left">
&nbsp;<a onClick="toggleDiv('advancedSearch');return false" href="#"><font size="1">Advanced Search</font></a>
<br>
&nbsp<a href="search.do?indexName=documenttypes&templateName=ROAMHelp&q=&length=300"><font size="1" style="vertical-align:text-top;">ROAM Help</font></a>
</td>
</tr>
       <tr >
         <td align="right">
             <input type="text" class="text" name="q" id="q" size="41" maxlength="2048" value="${searchResult.userInput?html}">
             <#if Request.searchForm.searchType = "1">
             <script language="javascript">  
                 document.getElementById('q').focus();
             </script>
             </#if>
          </td>
       </tr>
       
       
<tr><img src="templates/genesis/default/resource/spacer.png"></tr>
<tr><img src="templates/genesis/default/resource/spacer.png"></tr>

<tr>
<td align="center"></td>
  <td width="15%" align="center"><b><font class="label">Sort By&nbsp;:&nbsp;</font></b>

  <select name="basicSortOrder" id="basicSortOrder" class="sortBy">
      <option value="DateProcessedSort|Y">Date Processed : New to Old</option>
      <option value="DateProcessedSort|N">Date Processed : Old to New</option>
      <option value="EntityNameFilter|N">Name : A to Z</option>
      <option value="EntityNameFilter|Y">Name : Z to A</option>
  </select>
    <script language="javascript">                                          
        if (getCookie('bso') != null) {
            $('#basicSortOrder').val(getCookie('bso').toString());
        }  
    </script>
<td align="left"></td> 

  </td>
</tr>
       
</table>
<center><img src="templates/genesis/default/resource/spacer.png"></center>
<center><img src="templates/genesis/default/resource/spacer.png"></center>

<table border="0" align = "center">
<tr>

                        <td align="left">   
                            <button type="button" class="search" onclick="javascript:postBasicSearch()">Search</button>
                        </td>
                        <td align="left"><a onClick="toggleDiv('advancedSearch');return false" href="#"><font size="1">Advanced Search</font></a>   
                        </td>
                </tr>       
            </table>
            
        </div>

            <#if Request.searchForm.searchType = "2">
                <div id="advancedSearch">
            <#else>
                <div id="advancedSearch" style="display:none">
            </#if>

        <table align="center" border="0" cellspacing="1" cellpadding="1" style="margin-left:300px;">
                                <tr>                                
                                    <td align="right"><b><font class="label">${searchResult.datasetConfiguration.getColumn("DateProcessed").displayName}&nbsp;:&nbsp;</font></b></td>
                                        <td><b><font class="label">From&nbsp;:&nbsp;</font></b>
                                            <input type="text" id="frmDateProcessed" name="DateProcessed" title="${searchResult.datasetConfiguration.getColumn("DateProcessed").displayName}" size="10" maxlength="10" >
                                            <script language="javascript">
                                                $(function() {
								var dates = $( "#frmDateProcessed, #toDateProcessed" ).datepicker({                 
									changeYear: true, 
									changeMonth: true,
									numberOfMonths: 1,
									onSelect: function( selectedDate ) {
									var option = this.id == "frmDateProcessed" ? "minDate" : "maxDate",
										instance = $( this ).data( "datepicker" );
									date = $.datepicker.parseDate(
										instance.settings.dateFormat ||
										$.datepicker._defaults.dateFormat,
										selectedDate, instance.settings );
									dates.not( this ).datepicker( "option", option, date );
									}
								});
							});
                                                if (getCookie('defaultfrmDateProcessed') != null) {
                                                    document.getElementById("frmDateProcessed").value = getCookie('defaultfrmDateProcessed');
                                                }
                                            </script>
                                        </td>    
                                        <td><b><font class="label">To&nbsp;:&nbsp;</font></b>
                                            <input type="text" id="toDateProcessed" name="DateProcessed" title="${searchResult.datasetConfiguration.getColumn("DateProcessed").displayName}" size="10" maxlength="10">
                                            <script language="javascript">                                               
                                                if (getCookie('defaulttoDateProcessed') != null) {
                                                    document.getElementById("toDateProcessed").value = getCookie('defaulttoDateProcessed');
                                                }
                                            </script>
                                        </td>    
                                        <td align="left">
                                            <select name="DateProcessed_select" id="DateProcessed_select" >
                                                <option value="AND" >AND</option>
                                                <option value="OR" >OR</option>
                                                <option value="NOT" >NOT</option>
                                            </select>
                                            <script language="javascript">                                          
                                                if (getCookie('defaultDateProcessed_select') != null) {
                                                    document.getElementById("DateProcessed_select").options[getCookie('defaultDateProcessed_select')].selected = true;
                                                }
                                            </script>                                           
                                        </td>
                                </tr>
                                <tr>                                
                                    <td align="right"><b><font class="label">${searchResult.datasetConfiguration.getColumn("EntityName").displayName}&nbsp;:&nbsp;</font></b></td>
                                        <td colspan="2">
                                            <input type="text" id="EntityName"  title="${searchResult.datasetConfiguration.getColumn("EntityName").displayName}" name="EntityName" size="70" maxlength="2048">
                                            <script language="javascript">                                          
                                                if (getCookie('defaultEntityName') != null) {
                                                    document.getElementById("EntityName").value = getCookie('defaultEntityName');
                                                }
                                            </script>
                                        </td>                                           
                                        <td align="left">
                                            <select style="display:none" name="EntityName_select" id="EntityName_select" >
                                                <option value="AND" >AND</option>
                                                <option value="OR" >OR</option>
                                            </select>
                                            <script language="javascript">                                          
                                                if (getCookie('defaultEntityName_select') != null) {
                                                    document.getElementById("EntityName_select").options[getCookie('defaultEntityName_select')].selected = true;
                                                }
                                            </script>                                           
                                        </td>
                                </tr>
                                <tr>                                
				    <td align="right"><b><font class="label">${searchResult.datasetConfiguration.getColumn("BatchID").displayName}&nbsp;:&nbsp;</font></b></td>
					<td colspan="2">
					    <input type="text" id="BatchID"  title="${searchResult.datasetConfiguration.getColumn("BatchID").displayName}" name="BatchID" size="70" maxlength="2048">
					    <script language="javascript">                                          
						if (getCookie('defaultBatchID') != null) {
						    document.getElementById("BatchID").value = getCookie('defaultBatchID');
						}
					    </script>
					</td>                                           
					<td align="left">
					    <select style="display:none" name="BatchID_select" id="BatchID_select" >
						<option value="AND" >AND</option>
						<option value="OR" >OR</option>
					    </select>
					    <script language="javascript">                                          
						if (getCookie('defaultBatchID_select') != null) {
						    document.getElementById("BatchID_select").options[getCookie('defaultBatchID_select')].selected = true;
						}
					    </script>                                           
					</td>
                                </tr>
				<tr>
					<td width="30%" align="right">
					<td id="newname" width="20%" colspan="2">
					<form id="newname1" OnKeyPress="return disableKeyPress(event)">
						<span id="nameStarts"><input type="radio" name="searchkindName" value="StartsName" checked="checked"/>Starts With</span>
						<span id="nameContains"><input type="radio" name="searchkindName" value="ContainsName"/>Contains</span>
						<span id="nameExact"><input type="radio" name="searchkindName" value="ExactName" />Exact</span>

					<script language="javascript">                                          
					     if (getCookie('searchkindName') != null) {
					     var radioFilter = "'[value=" + getCookie('searchkindName')+ "]'";
					     $('input:radio[name="searchkindName"]').filter(radioFilter ).attr('checked', true);
					     } else {
					     var radioFilter = "'[value=none]'"; 
					     $('input:radio[name="searchkindName"]').filter(radioFilter ).attr('checked', true);   
					     }
					</script>
					</form>
					</td>
					</td>
				</tr>
			  <#--START NAME SEARCH POP UP DIVs-->      
				<div id="nameStartsPopUp" style="position:absolute;">
					<p>
					The <font color="#2E7EE4"><b>Starts With</b></font> search option enables you to look for names that start with your search criteria. Do not use wild cards with this search option, as we've already used them for you.
					</p>
				</div>
				<div id="nameContainsPopUp" style="position:absolute;">
					<p>
					The <font color="#2E7EE4"><b>Contains</b></font> search option enables you to retrieve names that contain your search criteria. Do not use wild cards with this search option, as we've already used them for you.
					</p>
				</div>
				<div id="nameExactPopUp" style="position:absolute;">
					<p>
					The <font color="#2E7EE4"><b>Exact</b></font> search option should be used when searching for names that are recorded exactly as your seach criteria. Your search must exactly match the recorded value in order to be part of the results. 
					</p>
				</div>
<tr>
  <td width="15%" align="right"><b><font class="label">Sort By&nbsp;:&nbsp;</font></b></td>
  <td width="20%" colspan="2">
      <select name="advancedSortOrder" id="advancedSortOrder" class="sortBy">
        <option value="DateProcessedSort|Y">Date Processed : New to Old</option>
        <option value="DateProcessedSort|N">Date Processed : Old to New</option>
        <option value="EntityNameFilter|N">Name : A to Z</option>
        <option value="EntityNameFilter|Y">Name : Z to A</option>
      </select>
    <script language="javascript">                                          
        if (getCookie('adso') != null) {
            $('#advancedSortOrder').val(getCookie('adso').toString());
        }  
    </script>  
   </td>
</tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td align="right"><button type="button" class="search" onclick="javascript:postAdvancedSearch()">Search</button></td>
                            <td align="left"><a onClick="javascript:toggleDiv('basicSearch');return false;" href="#"><font size="1">Basic Search</font></a><br>
                            <a onClick="javascript:clearFormElements();return false;" href="#"><font size="1">Clear</font></a></td>
                            <td>&nbsp;</td>
                        </tr>
            </table>
        
        </div>
</form>

<#include "searchBox_extra.stl">
