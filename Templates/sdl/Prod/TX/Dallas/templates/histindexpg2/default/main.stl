<@com.useHighlightTag '<span class="highlight">', '</span>' />
<#include "layout.stl">
<@layout title="Historical Index" encoding="${searchResult.encoding}">

<#include "/templates/globalNav.stl">

<#--<#include "/templates/globalBriefCase-Historical.stl">-->

 <#include "searchBox.stl">
 <@com.errorMarkup/>
 <#include "displayPagination.stl">
 <#include "map.stl">
 <#include "searchResultHeader.stl">
 
 <br>

 
<#--Function for two new search buttons-->            
<script type="text/javascript">
		    function unique2(arrayName) {
			var newArray=new Array();
			label:for(var i=0; i<arrayName.length;i++ )
			{  
			    for(var j=0; j<newArray.length;j++ ) {
				if(newArray[j].name == arrayName[i].name) 
				 continue label;
			    }
			    setCookie('default' + arrayName[i].name, jQuery.trim(arrayName[i].value), 0);
			    if ((arrayName[i].type == 'text' || arrayName[i].type == 'select-one') && jQuery.trim(arrayName[i].value).length != 0) {
				newArray[newArray.length] = arrayName[i];
			    }
			}
			return newArray;
		    }   
		    function postAdvancedSearch2() {
			try {
			    document.getElementById("q").value = '';
			    var inputElemenets =  $('select#HistBookType,input#Book,input#Page');
			    var elem = unique2(inputElemenets);
			    var searchString = '';
			    var searchQuery = '';
			    var andOrClause ='';
			    var doubleQuotes = '"';
			    var counter = 0;
			    var textcounter = 0;
			    var searchValue = '';
			    var searchValueQuery = '';
			    for(var i = 0; i < elem.length; i++) {
				if (document.getElementById(elem[i].name + '_select') != null) {
				    counter++;  
				}                   
			    }
			    for(var i = 0; i < elem.length; i++) {
				if (document.getElementById(elem[i].name + '_select') != null) {
				    setCookie('default' + elem[i].name + '_select', document.getElementById(elem[i].name + '_select').selectedIndex, 0);
				    textcounter++
				    if (textcounter == counter) {
					andOrClause = '';
				    } else {
					andOrClause = '+' + document.getElementById(elem[i].name + '_select').value + '++';
				    }
					searchValue = elem[i].name + '%3A' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes + '%7E5';
					searchValue = '%23' + searchValue + '%23';
					searchValueQuery = elem[i].name + '%3A' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes;
				    searchString = searchString + searchValue + andOrClause;
				    searchQuery = searchQuery  + searchValueQuery + andOrClause;
				}
			    }
			    searchString="search.do?indexName=dallashistbook&templateName=&lq=" + searchString; 
			    window.open(searchString);

			} catch (err) {
			    $.prompt(err.message,{buttons:{Ok:true},	prefix:'extblue'});
			}
		    } 
		    
		  
		      function unique3(arrayName) {
		              var newArray=new Array();
		              label:for(var i=0; i<arrayName.length;i++ )
		              {  
		                  for(var j=0; j<newArray.length;j++ ) {
		                      if(newArray[j].name == arrayName[i].name) 
		                       continue label;
		                  }
		                  setCookie('default' + arrayName[i].name, jQuery.trim(arrayName[i].value), 0);           
		                  if ((arrayName[i].type == 'text' || arrayName[i].type == 'select-one') && jQuery.trim(arrayName[i].value).length != 0) {
		                      newArray[newArray.length] = arrayName[i];
		                  }
		              }
		              return newArray;
		          } 
		          
		          function postAdvancedSearch3() {
		              try {
		                  document.getElementById("q").value = '';
		                  var inputElemenets =  $('select#Booktype,select#BookName,select#IndexName, input#indexPage');           
		                  var elem = unique3(inputElemenets);		                  
		                  var searchString = '';
		                  var searchQuery = '';
		                  var andOrClause ='';
		                  var doubleQuotes = '"';
		                  var counter = 0;
		                  var textcounter = 0;
		                  var searchValue = '';
		                  var searchValueQuery = '';
		                  for(var i = 0; i < elem.length; i++) {
		                      if (document.getElementById(elem[i].name + '_select') != null) {
		                          counter++;  
		                      }                   
		                  }
		                  for(var i = 0; i < elem.length; i++) {
		                      if (document.getElementById(elem[i].name + '_select') != null) {
		                          setCookie('default' + elem[i].name + '_select', document.getElementById(elem[i].name + '_select').selectedIndex, 0);
		                          textcounter++
		                          if (textcounter == counter) {
		                              andOrClause = '';
		                          } else {
		                              andOrClause = ' ' + document.getElementById(elem[i].name + '_select').value + '  ';
		                          }
		                              searchValue = elem[i].name + ':' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes + '~5';
		                              searchValue = '#' + searchValue + '#';
		                              searchValueQuery = elem[i].name + ':' + doubleQuotes + jQuery.trim(elem[i].value) + doubleQuotes;
		                          searchString = searchString + searchValue + andOrClause;
		                          searchQuery = searchQuery  + searchValueQuery + andOrClause;
		                      }
		                  }
                        document.getElementById("lq").value = searchString;
 				            document.getElementById("searchQuery").value = searchQuery;
				            document.search_${searchResult.indexName}.method = "get";
				            document.search_${searchResult.indexName}.action = "search.do";
				            document.search_${searchResult.indexName}.searchType.value = "2";           
                        document.search_${searchResult.indexName}.submit();
		                 
		              } catch (err) {
		                  $.prompt(err.message,{buttons:{Ok:true},	prefix:'extblue'});
		              }
		          } 
		          
</script>
	       <table align="center"><tr align="center"><td align="center"><b>Historic Book Search</b></td></tr></table>
               <table class="bookSearch" align="center">
                       <tr valign="top">
	 	               <td align="right" name="q"><b><font class="label">Book Type&nbsp;:&nbsp;</font></b></td>
			       <td  align="left">
					<#function getDocument URL, indexName, query>
						<#assign sc = new("net.javacoding.xsearch.api.SearchConnection")>
						<#assign searchQuery = new("net.javacoding.xsearch.api.SearchQuery")>
						${sc.setIndex(indexName)}
						${sc.setURL(URL)}
						${searchQuery.setAdvancedQuery(query)}
						<#assign sr = sc.search(searchQuery)>
						<#return sr.getDocList()>
					</#function>
	
					<#--<#assign uri = pageStyleUtil.getSystemValue(null, "url") + request.getContextPath()>-->
					<#assign histbooktypes = getDocument("http://roamdallaspropertyrecords.com/ailis/", "histbooktype", "")>
					<select name="HistBookType" id="HistBookType">
							  <option value="">Select a Book Type</option>
					     <#if histbooktypes?has_content>
						 <#foreach doc in histbooktypes>
						      <option value="${doc.getString("HistBookType")}">${doc.getString("HistBookType")}</option>  
						 </#foreach>
					     </#if>
					</select>
				    <script language="javascript">                                          
					if (getCookie('defaultHistBookType') != null) {
					    //alert(getCookie('defaultHistBookType'));
					    document.getElementById("HistBookType").value = getCookie('defaultHistBookType');
					}
				     </script>
				     <td align="left" style="display:none;">
					    <select name="HistBookType_select" id="HistBookType_select" >
						<option value="AND" >AND</option>
						<option value="OR" >OR</option>
					    </select>
					    <script language="javascript">                                          
						if (getCookie('defaultHistBookType_select') != null) {
						    document.getElementById("HistBookType_select").options[getCookie('defaultHistBookType_select')].selected = true;
						}
					    </script>                                           
				      </td>
	                                    <#if Request.searchForm.searchType = "1">
						 <script language="javascript">  
						       document.getElementById('q').focus();
					 </script>
				     </#if>
				    </td>
				
				    <td align="right" name="q"><b><font class="label">Book&nbsp;:&nbsp;</font></b></td>
	
					<td align="left">
					    <input type="text" id="Book"  name="Book" size="30" maxlength="2048">
					    <script language="javascript">                                          
						if (getCookie('defaultBook') != null) {
						    document.getElementById("Book").value = getCookie('defaultBook');
						}
					    </script>
					</td>                                           
					<td align="left" style="display:none;">
					    <select name="Book_select" id="Book_select" >
						<option value="AND" >AND</option>
						<option value="OR" >OR</option>
						<option value="NOT" >NOT</option>
					    </select>
					    <script language="javascript">                                          
						if (getCookie('defaultBook_select') != null) {
						    document.getElementById("Book_select").options[getCookie('defaultBook_select')].selected = true;
						}
					    </script>                                           
					</td>
	
				    <td align="right"><b><font class="label">Page&nbsp;:&nbsp;</font></b></td>
	
	
					<td align="left">
					    <input type="text" id="Page"  name="Page" size="30" maxlength="2048">
					    <script language="javascript">                                          
						if (getCookie('defaultPage') != null) {
						    document.getElementById("Page").value = getCookie('defaultPage');
						}
					    </script>
					</td>                                           
					<td align="left">
					    <select style="display:none" name="Page_select" id="Page_select" >
						<option value="AND" >AND</option>
						<option value="OR" >OR</option>
					    </select>
					    <script language="javascript">                                          
						if (getCookie('defaultPage_select') != null) {
						    document.getElementById("Page_select").options[getCookie('defaultPage_select')].selected = true;
						}
					    </script>                                           
					</td>
	                                <td ><button type="button" class="search" onclick="javascript:postAdvancedSearch2()">Search</button></td>
				   <#-- <td><a onClick="javascript:clearFormElements();return false;" href="#"><font size="1">Clear</font></a></td>-->
	                         </tr>
                             </table>
 <table class="main">
 	        	   
 		<td class="mainLeft">
 		        <div>
 		            <table>
 		            	<tr>
				       <td align="left" id ="q" name="q"><b><font class="label">Index Page</font></b></td>
				   </tr>
				   <tr>
				       <td align="left">
					   <input type="text" id="indexPage"  name="indexPage" size="10" maxlength="2048">
					   <select name="indexPage_select" id="indexPage_select" style="display:none;">
						<option value="AND">AND</option>
						<option value="OR">OR</option>
					    </select>
					   <script language="javascript">                                          
						   if (getCookie('defaultindexPage') != null) {
						       document.getElementById("indexPage").value = getCookie('defaultindexPage');
						   }
					   </script>
				       </td>
				  </tr>
				  <tr>
				       <td>
					  <button type="button" class="searchSmall" onclick="javascript:postAdvancedSearch3()">Search</button>
				       </td>
			          </tr>
 		            </table>
 		        
 		        <div id="documents">
		           <#include "documents.stl">
	                </div>
	       </td>
	       <td class="mainRight" style="float:right">
	                <div id="iframe">
	       		   <iframe frameborder=0 height=1000 width=1500 name="image" id="image" src='search.do?indexName=histindeximages&lq=ID%3A4<>' allowtransparency="true">Your browser does not support iframes.</iframe>
	       	        </div>
	       </td>
       </tr>
 	
 </table>
      
 <script>

$(document).ready(function() {
  var url = '${request.getContextPath()}/search.do?indexName=histindeximages&lq=${pageStyleUtil.encodeURL("ID:" + request.getParameter("imageID"))}&page=1&view=FitV&scrollbar=0&navpanes=0&statusbar=0&messages=0?iframe=true&width=50%25&height=95%25'

   $('iframe#image').attr('src', url);
});
 </script>


 <#include "displayPagination.stl">

 <#include "resultsPerPage.stl">
</@layout>

