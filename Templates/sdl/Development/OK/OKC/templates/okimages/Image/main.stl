<#-- ADD GOOGLE ANALYTICS -->
<#include "/templates/googleAnalytics-OK.stl">

<#if searchResult.docs?has_content>
    <#foreach doc in searchResult.docs>
        <#assign imagelocation = "\\\\" + doc.get("Server") + "\\" + doc.get("Path") + "\\" + doc.get("Year") + "\\" + doc.get("Month") + "\\" + doc.get("Day") + "\\" + doc.get("ImageName")> 
        
        <#assign baos = new("java.io.ByteArrayOutputStream")>
        <#assign converter = new("com.fdt.common.util.TIFFToPDFConverter")>
            <#if (converter.convert(imagelocation + ".tif" , "",159,159,159, baos) == true)> 
                ${response.reset()}
                ${response.resetBuffer()}
                ${response.setContentType("application/pdf")}
                ${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
                ${response.setHeader("Expires", " 0")}
                ${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
                ${response.setHeader("Pragma" , "public")}      
                ${baos.writeTo(response.getOutputStream())}
                ${response.getOutputStream().flush()}
            <#elseif (converter.convert(imagelocation + ".burned", "",159,159,159, baos) == true)>        
                ${response.reset()}
                ${response.resetBuffer()}
                ${response.setContentType("application/pdf")}
                ${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
                ${response.setHeader("Expires", " 0")}
                ${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
                ${response.setHeader("Pragma" , "public")}      
                ${baos.writeTo(response.getOutputStream())}
                ${response.getOutputStream().flush()}
            <#elseif (converter.convert(imagelocation, "",159,159,159, baos) == true)>        
                ${response.reset()}
                ${response.resetBuffer()}
                ${response.setContentType("application/pdf")}
                ${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
                ${response.setHeader("Expires", " 0")}
                ${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
                ${response.setHeader("Pragma" , "public")}      
                ${baos.writeTo(response.getOutputStream())}
                ${response.getOutputStream().flush()}
 
            <#else>
                <br>
                <br>
                <br>
                <center><h3 style="color:#2e7ee4;"><b>No Image Found: <br/> ${imagelocation}</b></h3></center>
                <center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>                  
            </#if>
    </#foreach>
<#else>
    <#include "denied.html">
</#if>