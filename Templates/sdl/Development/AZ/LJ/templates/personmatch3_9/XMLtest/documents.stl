<#assign num_pages = (searchResult.total/searchResult.length)?int>

<#if num_pages*searchResult.length < searchResult.total>
 <#assign num_pages = num_pages + 1>
</#if>
<#assign current_page_index = (searchResult.start/searchResult.length)?int + 1>

<#assign startItemIndex = (current_page_index-1)*searchResult.length + 1>
<#assign endItemIndex = current_page_index*searchResult.length>
<#if (endItemIndex>searchResult.total)>
 <#assign endItemIndex = searchResult.total>
</#if>

<#assign searchQuery = request.getParameter("searchQuery")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign firstnameQuery = request.getParameter("FIRSTNAME")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign firstnamelikeQuery = request.getParameter("FIRSTNAMELIKE")?replace('"', '')?replace(':','')?replace(' ','')?replace('*','')>
<#assign middlenameQuery = request.getParameter("MIDDLENAME")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign middlenamelikeQuery = request.getParameter("MIDDLENAMELIKE")?replace('"', '')?replace(':','')?replace(' ','')?replace('*','')>
<#assign lastnameQuery = request.getParameter("LASTNAME")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign lastnamelikeQuery = request.getParameter("LASTNAMELIKE")?replace('"', '')?replace(':','')?replace(' ','')?replace('*','')>
<#assign lastnamesoundexQuery = request.getParameter("LASTNAMESOUNDEX")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign suffixnameQuery = request.getParameter("SUFFIXNAME")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign dlnumberQuery = request.getParameter("DLNUMBER")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign dlstateQuery = request.getParameter("DLSTATE")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign dobQuery = request.getParameter("DOB")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign genderQuery = request.getParameter("GENDER")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign ssnQuery = request.getParameter("SSN")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign addressQuery = request.getParameter("ADDRESS")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign dlplateQuery = request.getParameter("DLPLATE")?replace('"', '')?replace(':','')?replace(' ','')>
<#assign dlplatestateQuery = request.getParameter("DLPLATESTATE")?replace('"', '')?replace(':','')?replace(' ','')>


<Items>
  <TotalResults>${total}</TotalResults>
  <TotalPages>${num_pages}</TotalPages>
  <CurrentPage>${current_page_index}</CurrentPage>
  <PageLength>${length}</PageLength>
  <StartItemIndex>${startItemIndex}</StartItemIndex>
  <EndItemIndex>${endItemIndex}</EndItemIndex>
  <RequestProcessingTime>${searchTime}</RequestProcessingTime>
  <QueryString><![CDATA[${q}]]></QueryString>
<searchQuery>${searchQuery}</searchQuery>
<firstnameQuery>${firstnameQuery}</firstnameQuery>
<middlenameQuery>${middlenameQuery}</middlenameQuery>
<lastnameQuery>${lastnameQuery}</lastnameQuery>


  <#if searchResult.docs?has_content>
  <#foreach doc in searchResult.docs>
  <Item>
<PERSON_ALIAS_IDS>
<PERSON_ALIAS_ID> <![CDATA[${doc.get("PERSON_ALIAS_ID")}]]> </PERSON_ALIAS_ID>
<#assign FIRSTNAME = doc.getValues("FIRSTNAME")>
<#assign FIRSTNAMELIKE = doc.getValues("FIRSTNAMELIKE")>
<#assign MIDDLENAME = doc.getValues("MIDDLENAME")>
<#assign MIDDLENAMELIKE = doc.getValues("MIDDLENAMELIKE")>
<#assign LASTNAME = doc.getValues("LASTNAME")>
<#assign LASTNAMELIKE = doc.getValues("LASTNAMELIKE")>
<#assign LASTNAMESOUNDEX = doc.getValues("LASTNAMESOUNDEX")>
<#assign SUFFIXNAME = doc.getValues("SUFFIXNAME")>
<#assign PERSONHIGHLIGHTER = "">
<#assign loopCounter = 0>
<PERSONS>
     <#foreach PERSONID in doc.getValues("PERSONID")>
<PERSON>
<#assign firstnameQuerywords = firstnameQuery?replace('!', ' ')>
<#assign firstnameWORDS = firstnameQuerywords?word_list>
<#assign firstnamelikeQuerywords = firstnamelikeQuery?replace('!', ' ')>
<#assign firstnamelikeWORDS = firstnamelikeQuerywords?word_list>
<#assign middlenameQuerywords = middlenameQuery?replace('!', ' ')>
<#assign middlenameWORDS = middlenameQuerywords?word_list>
<#assign middlenamelikeQuerywords = middlenamelikeQuery?replace('!', ' ')>
<#assign middlenamelikeWORDS = middlenamelikeQuerywords?word_list>
<#assign lastnameQuerywords = lastnameQuery?replace('!', ' ')>
<#assign lastnameWORDS = lastnameQuerywords?word_list>
<#assign lastnamelikeQuerywords = lastnamelikeQuery?replace('!', ' ')>
<#assign lastnamelikeWORDS = lastnamelikeQuerywords?word_list>
<#assign lastnamesoundexQuerywords = lastnamesoundexQuery?replace('!', ' ')>
<#assign lastnamesoundexWORDS = lastnamesoundexQuerywords?word_list>
<#assign suffixnameQuerywords = suffixnameQuery?replace('!', ' ')>
<#assign suffixnameWORDS = suffixnameQuerywords?word_list>
<#list firstnameWORDS as FIRSTNAMEWORD>  
<#if FIRSTNAME[loopCounter]?replace('AMCADDBNULL','')?replace(' ', '')?matches(FIRSTNAMEWORD)> <#assign firstnamematch = "true"> <#break> <#else> <#assign firstnamematch = "false"> </#if> 
</#list>
<#list firstnamelikeWORDS as FIRSTNAMELIKEWORD>  
<#if FIRSTNAMELIKE[loopCounter]?replace('|','')?replace(' ', '')?matches(FIRSTNAMELIKEWORD)> <#assign firstnamelikematch = "true"> <#break> <#else> <#assign firstnamelikematch = "false"> </#if> 
</#list>
<#list middlenameWORDS as MIDDLENAMEWORD>  
<#if MIDDLENAME[loopCounter]?replace('AMCADDBNULL','')?replace(' ', '')?matches(MIDDLENAMEWORD)>  <#assign middlenamematch = "true"> <#break> <#else> <#assign middlenamematch = "false">  </#if> 
</#list>
<#list middlenamelikeWORDS as MIDDLENAMELIKEWORD>  
<#if MIDDLENAMELIKE[loopCounter]?replace('|','')?replace(' ', '')?matches(MIDDLENAMELIKEWORD)> <#assign middlenamelikematch = "true"> <#break> <#else> <#assign middlenamelikematch = "false"> </#if> 
</#list>
<#list lastnameWORDS as LASTNAMEWORD>  
<#if LASTNAME[loopCounter]?replace('|','')?replace(' ', '')?matches(LASTNAMEWORD)> <#assign lastnamematch = "true"> <#break> <#else> <#assign lastnamematch = "false"> </#if> 
</#list> 
<#list lastnamelikeWORDS as LASTNAMELIKEWORD>  
<#if LASTNAMELIKE[loopCounter]?replace('|','')?replace(' ', '')?contains(LASTNAMELIKEWORD)> <#assign lastnamelikematch = "true"> <#break> <#else> <#assign lastnamelikematch = "false"> </#if> 
</#list>
<#list lastnamesoundexWORDS as LASTNAMESOUNDEXWORD>  
<#if LASTNAMESOUNDEX[loopCounter]?replace('|','')?replace(' ', '')?matches(LASTNAMESOUNDEXWORD) || searchResult.highlight(LASTNAMESOUNDEX[loopCounter]?replace('|', ''), "LASTNAMESOUNDEX")?contains("<B>") || searchResult.highlight(LASTNAMESOUNDEXWORD, "LASTNAMESOUNDEXWORD")?contains("<B>")> <#assign lastnamesoundexmatch = "true"> <#break> <#else> <#assign lastnamesoundexmatch = "false"> </#if> 
</#list>
<#list suffixnameWORDS as SUFFIXNAMEWORD>  
<#if SUFFIXNAME[loopCounter]?replace('AMCADDBNULL','')?replace(' ', '')?matches(SUFFIXNAMEWORD)>  <#assign suffixnamematch = "true"> <#break> <#else> <#assign suffixnamematch = "false"> </#if> 
</#list>
<#if !firstnameQuery?has_content && !firstnamelikeQuery?has_content && !middlenameQuery?has_content && !middlenamelikeQuery?has_content && !lastnameQuery?has_content && !lastnamelikeQuery?has_content && !lastnamesoundexQuery?has_content && !suffixnameQuery?has_content> <#assign firstnamematch = "false"> <#assign firstnamelikematch = "false"> <#assign middlenamematch = "false"> <#assign middlenamelikematch = "false"> <#assign lastnamematch = "false"> <#assign lastnamelikematch = "false"> <#assign lastnamesoundexmatch = "false"> <#assign suffixnamematch = "false"></#if>
<#if firstnamematch != "false" && firstnamelikematch != "false" && middlenamematch != "false" && middlenamelikematch != "false" && lastnamematch != "false" && lastnamelikematch != "false" && lastnamesoundexmatch != "false" && suffixnamematch != "false">
<#assign HIGHLIGHT = "true">
<#else>
<#assign HIGHLIGHT = "false">
</#if>
               <SEARCHTERM><#if HIGHLIGHT = "true">TRUE<#else>FALSE</#if></SEARCHTERM>
               <PERSONID>  <![CDATA[${PERSONID?replace('|', '')}]]> </PERSONID>
               <FIRSTNAME ><![CDATA[${FIRSTNAME[loopCounter]?replace('AMCADDBNULL', '')}]]></FIRSTNAME>
               <FIRSTNAMELIKE><![CDATA[${FIRSTNAMELIKE[loopCounter]?replace('|', '')}]]></FIRSTNAMELIKE>
               <MIDDLENAME><![CDATA[${MIDDLENAME[loopCounter]?replace('AMCADDBNULL', '')}]]></MIDDLENAME>
               <MIDDLENAMELIKE><![CDATA[${MIDDLENAMELIKE[loopCounter]?replace('|', '')}]]></MIDDLENAMELIKE>
               <LASTNAME><![CDATA[${LASTNAME[loopCounter]?replace('|', '')}]]></LASTNAME>
               <LASTNAMELIKE><![CDATA[${LASTNAMELIKE[loopCounter]?replace('|', '')}]]></LASTNAMELIKE>
               <LASTNAMESOUNDEX><![CDATA[${LASTNAMESOUNDEX[loopCounter]?replace('|', '')}]]></LASTNAMESOUNDEX>
               <SUFFIXNAME><![CDATA[${SUFFIXNAME[loopCounter]?replace('AMCADDBNULL', '')}]]></SUFFIXNAME>
</PERSON>
<#assign loopCounter = loopCounter + 1>
</#foreach>
</PERSONS>
<#assign DLNUMBER = doc.getValues("DLNUMBER")>
<#assign DLSTATE = doc.getValues("DLSTATE")>
<#assign loopCounter = 0>
<DRIVERSLICENSES>
     <#foreach DRIVERS_LICENSEID in doc.getValues("DRIVERS_LICENSEID")>
<DRIVERSLICENSE>
<#assign dlnumberQuerywords = dlnumberQuery?replace('!', ' ')>
<#assign dlnumberWORDS = dlnumberQuerywords?word_list>
<#assign dlstateQuerywords = dlstateQuery?replace('!', ' ')>
<#assign dlstateWORDS = dlstateQuerywords?word_list>
<#list dlnumberWORDS as DLNUMBERWORD>  
<#if DLNUMBER[loopCounter]?replace('AMCADDBNULL','')?replace(' ', '')?matches(DLNUMBERWORD)>  <#assign dlnumbermatch = "true"> <#break> <#else> <#assign dlnumbermatch = "false"> </#if> 
</#list>
<#list dlstateWORDS as DLSTATEWORD>  
<#if DLSTATE[loopCounter]?replace('AMCADDBNULL','')?replace(' ', '')?matches(DLSTATEWORD)>  <#assign dlstatematch = "true"> <#break> <#else> <#assign dlstatematch = "false"> </#if> 
</#list>
<#if !dlnumberQuery?has_content && !dlstateQuery?has_content> <#assign dlstatematch = "false"> <#assign dlnumbermatch = "false"> </#if>
<#if dlnumbermatch != "false" && dlstatematch != "false">
<#assign HIGHLIGHT = "true">
<#else>
<#assign HIGHLIGHT = "false">
</#if>
<SEARCHTERM><#if HIGHLIGHT = "true">TRUE<#else>FALSE</#if></SEARCHTERM>               
<DRIVERS_LICENSEID> <![CDATA[${DRIVERS_LICENSEID?replace('|', '')}]]> </DRIVERS_LICENSEID>
<DLNUMBER><![CDATA[${DLNUMBER[loopCounter]?replace('AMCADDBNULL', '')}]]></DLNUMBER>
<DLSTATE><![CDATA[${DLSTATE[loopCounter]?replace('AMCADDBNULL', '')}]]></DLSTATE>
</DRIVERSLICENSE>
<#assign loopCounter = loopCounter + 1>
</#foreach>
</DRIVERSLICENSES>
<#assign DOB = doc.getValues("DOB")>
<#assign GENDER = doc.getValues("GENDER")>
<#assign loopCounter = 0>
<PHYSICALCHARACTERISTICS>
     <#foreach PHYSICALID in doc.getValues("PHYSICALID")>
<PHYSICALCHARACTERISITIC>
<#assign dobQuerywords = dobQuery?replace('!', ' ')>
<#assign dobWORDS = dobQuerywords?word_list>
<#assign genderQuerywords = genderQuery?replace('!', ' ')>
<#assign genderWORDS = genderQuerywords?word_list>
<#list dobWORDS as DOBWORD>  
<#if DOB[loopCounter]?replace('AMCADDBNULL','')?replace(' ', '')?matches(DOBWORD)>  <#assign dobmatch = "true"> <#break> <#else> <#assign dobmatch = "false"> </#if> 
</#list>
<#list genderWORDS as GENDERWORD>  
<#if GENDER[loopCounter]?replace('AMCADDBNULL','')?replace(' ', '')?matches(GENDERWORD)>  <#assign gendermatch = "true"> <#break> <#else> <#assign gendermatch = "false"> </#if> 
</#list>
<#if !dobQuery?has_content && !genderQuery?has_content> <#assign dobmatch = "false"> <#assign gendermatch = "false"> </#if>
<#if dobmatch != "false" && gendermatch != "false">
<#assign HIGHLIGHT = "true">
<#else>
<#assign HIGHLIGHT = "false">
</#if>
               <SEARCHTERM><#if HIGHLIGHT = "true">TRUE<#else>FALSE</#if></SEARCHTERM>  
               <PHYSICALID> <![CDATA[${PHYSICALID?replace('|', '')}]]> </PHYSICALID>
               <DOB><![CDATA[${DOB[loopCounter]?replace('AMCADDBNULL', '')}]]></DOB>
               <GENDER><![CDATA[${GENDER[loopCounter]?replace('AMCADDBNULL', '')}]]></GENDER>
</PHYSICALCHARACTERISITIC>
               <#assign loopCounter = loopCounter + 1>
     </#foreach>
</PHYSICALCHARACTERISTICS>
<#assign SSN = doc.getValues("SSN")>
<#assign loopCounter = 0>
<IDENTITIES>
     <#foreach IDENTITYID in doc.getValues("IDENTITYID")>
<IDENTITY>
<#assign ssnQuerywords = ssnQuery?replace('!', ' ')>
<#assign ssnWORDS = ssnQuerywords?word_list>
<#list ssnWORDS as SSNWORD>  
<#if SSN[loopCounter]?replace('AMCADDBNULL','')?replace(' ', '')?matches(SSNWORD)>  <#assign ssnmatch = "true"> <#break> <#else> <#assign ssnmatch = "false"> </#if> 
</#list>
<#if ssnmatch = "true">
<#assign HIGHLIGHT = "true">
<#else>
<#assign HIGHLIGHT = "false">
</#if>
               <SEARCHTERM><#if HIGHLIGHT = "true">TRUE<#else>FALSE</#if></SEARCHTERM>   
               <IDENTITYID> <![CDATA[${IDENTITYID?replace('|', '')}]]>  </IDENTITYID>
               <SSN><![CDATA[${SSN[loopCounter]?replace('AMCADDBNULL', '')}]]></SSN>
</IDENTITY>
               <#assign loopCounter = loopCounter + 1>
     </#foreach>
</IDENTITIES>
<#assign ADDRESS = doc.getValues("ADDRESS")>
<#assign loopCounter = 0>
<ADDRESSES>
     <#foreach ADDRESSID in doc.getValues("ADDRESSID")>
<ADDRESS>
<#assign addressQuerywords = addressQuery?replace('!', ' ')>
<#assign addressWORDS = addressQuerywords?word_list>
<#list addressWORDS as ADDRESSWORD>  
<#if ADDRESS[loopCounter]?replace('|','')?replace(' ', '')?matches(ADDRESSWORD)>  <#assign addressmatch = "true"> <#break> <#else> <#assign addressmatch = "false"> </#if> 
</#list>
<#if addressmatch = "true">
<#assign HIGHLIGHT = "true">
<#else>
<#assign HIGHLIGHT = "false">
</#if>
               <SEARCHTERM><#if HIGHLIGHT = "true">TRUE<#else>FALSE</#if></SEARCHTERM>   
               <ADDRESSID> <![CDATA[${ADDRESSID?replace('|', '')}]]> </ADDRESSID>
               <STREETADDRESS><![CDATA[${ADDRESS[loopCounter]?replace('|', '')}]]></STREETADDRESS>
</ADDRESS>
               <#assign loopCounter = loopCounter + 1>
     </#foreach>
</ADDRESSES>
<#assign DLPLATE = doc.getValues("DLPLATE")>
<#assign DLPLATESTATE = doc.getValues("DLPLATESTATE")>
<#assign loopCounter = 0>
<PLATES>
     <#foreach PLATEID in doc.getValues("PLATEID")>
<PLATE>
<#assign dlplateQuerywords = dlplateQuery?replace('!', ' ')>
<#assign dlplateWORDS = dlplateQuerywords?word_list>
<#assign dlplatestateQuerywords = dlplatestateQuery?replace('!', ' ')>
<#assign dlplatestateWORDS = dlplatestateQuerywords?word_list>
<#list dlplateWORDS as DLPLATEWORD>  
<#if DLPLATE[loopCounter]?replace('|','')?replace(' ', '')?matches(DLPLATEWORD)>  <#assign dlplatematch = "true"> <#break> <#else> <#assign dlplatematch = "false"> </#if> 
</#list>
<#list dlplatestateWORDS as DLPLATESTATEWORD>  
<#if DLPLATESTATE[loopCounter]?replace('|','')?replace(' ', '')?matches(DLPLATESTATEWORD)>  <#assign dlplatestatematch = "true"> <#break> <#else> <#assign dlplatestatematch = "false"> </#if> 
</#list>
<#if !dlplateQuery?has_content && !dlplatestateQuery?has_content> <#assign dlplatestatematch = "false"> <#assign dlplatematch = "false"> </#if>
<#if dlplatematch != "false" && dlplatestatematch != "false">
<#assign HIGHLIGHT = "true">
<#else>
<#assign HIGHLIGHT = "false">
</#if>
               <SEARCHTERM><#if HIGHLIGHT = "true">TRUE<#else>FALSE</#if></SEARCHTERM>   
               <PLATEID> <![CDATA[${PLATEID?replace('|', '')}]]> </PLATEID>
               <DLPLATE><![CDATA[${DLPLATE[loopCounter]?replace('|', '')}]]></DLPLATE>
               <DLPLATESTATE><![CDATA[${DLPLATESTATE[loopCounter]?replace('|', '')}]]></DLPLATESTATE>
</PLATE>
               <#assign loopCounter = loopCounter + 1>
     </#foreach>
</PLATES>
</PERSON_ALIAS_IDS>
  </Item>
  </#foreach>
  </#if>
</Items>