<#-- ADD GOOGLE ANALYTICS -->
<#include "/templates/googleAnalytics-NC.stl">

<#if searchResult.docs?has_content>${imagelocation}
	<#foreach doc in searchResult.docs>
		<#assign imagelocation = "\\\\" + doc.get("Server") + "\\" +  doc.get("Path") + "\\" + doc.get("Year") + "\\" + doc.get("Month") + "\\" + doc.get("Day") + "\\" + doc.get("ImageName")>
                <#assign baos  = new("java.io.ByteArrayOutputStream")>
		<#assign converter = new("com.fdt.common.util.TIFFToPDFConverter")>
	<#if doc.get("QueueStatus")="5">
                <#if (converter.convert(imagelocation + ".burned", "",159,159,159,0,0,true,baos,false,1) == true)>  
			${response.reset()}
			${response.resetBuffer()}
			${response.setContentType("application/pdf")}
			${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
			${response.setHeader("Expires", " 0")}
			${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
			${response.setHeader("Pragma" , "public")}      
			${baos.writeTo(response.getOutputStream())}
			${response.getOutputStream().flush()}
		<#elseif (converter.convert(imagelocation, "",159,159,159,0,0,true,baos,false,1) == true)>   
	         	${response.reset()}
			${response.resetBuffer()}
			${response.setContentType("application/pdf")}
			${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
			${response.setHeader("Expires", " 0")}
			${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
			${response.setHeader("Pragma" , "public")}      
			${baos.writeTo(response.getOutputStream())}
			${response.getOutputStream().flush()}
		<#else>
			<br>
			<br>
			<center><b>Image is Unavailable.</b></center>
                        <br>
                        <center><b>Please contact the Orange County Register of Deeds Office at 919-245-2702 with the <i>Boook & Page</i> number you are trying to view.</b></center>
			<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
		</#if>
        
        
        <#else>
			<br>
			<br>
			<center><b>Image is Unavailable at this time.</b></center>
           <#--REMOVE PER COUNTY REQUEST. PUBLIC USERS SHOULD NOT SEE UNVERIFIED/UNOFFICIAL IMAGES
                <#if (converter.convert(imagelocation + ".burned", "UNOFFICIAL",159,159,159,0,0,true,baos,false,1) == true)>
			${response.reset()}
			${response.resetBuffer()}
			${response.setContentType("application/pdf")}
			${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
			${response.setHeader("Expires", " 0")}
			${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
			${response.setHeader("Pragma" , "public")}      
			${baos.writeTo(response.getOutputStream())}
			${response.getOutputStream().flush()}
		<#elseif (converter.convert(imagelocation, "UNOFFICIAL",159,159,159,0,0,true,baos,false,1) == true)>   
	         	${response.reset()}
			${response.resetBuffer()}
			${response.setContentType("application/pdf")}
			${response.setHeader("Content-Disposition",  " inline; filename=document.pdf" )}
			${response.setHeader("Expires", " 0")}
			${response.setHeader("Cache-Control", " must-revalidate, post-check=0, pre-check=0" )} 
			${response.setHeader("Pragma" , "public")}      
			${baos.writeTo(response.getOutputStream())}
			${response.getOutputStream().flush()}
		<#else>
			<br>
			<br>
			<center><b>Image is Unavailable.</b></center>
                        <br>
                        <center><b>Please contact the Orange County Register of Deeds Office at 919-245-2702 with the <i>Book & Page</i> number you are trying to view.</b></center>
			<center><img title="Preview" src="<@com.currentUrlPrefix/>/blank.png"></center>
		</#if>
	-->
      </#if>
    </#foreach>
<#else>
	<#include "denied.html">
</#if>